<!DOCTYPE html>
<html>

  <head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>RNA-seq 中的基因表达量计算和表达差异分析</title>

	<link rel="shortcut icon" href="/styles/images/favicon.jpg">
	<link rel="icon" href="/styles/images/favicon.jpg">

	<link rel="stylesheet" href="/styles/css/index.css">
	<link rel="stylesheet" href="/styles/css/fontawesome/css/font-awesome.min.css">
	<link rel="canonical" href="/2017/04/06/RNA-seq-gene-difficultily-expression-analysis-DENOVO/">
	<link rel="alternate" type="application/rss+xml" title="Gossie's daily life" href="/feed.xml">
	
	<meta name="description" content="">

	<script src="/styles/js/jquery.min.js"></script>
	<!--[if lt IE 9]>
    	<script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  	<![endif]-->
  	<script>
		var _hmt = _hmt || [];
		(function() {
		  var hm = document.createElement("script");
		  hm.src = "//hm.baidu.com/hm.js?94be4b0f9fc5d94cc0d0415ea6761ae9";
		  var s = document.getElementsByTagName("script")[0]; 
		  s.parentNode.insertBefore(hm, s);
		})();
	</script>
  	<style type="text/css">
	  	.docs-content{
	  		margin-bottom: 10px;
	  	}
  	</style>
</head>


  <body class="index">

    <header class="navbar navbar-inverse navbar-fixed-top docs-nav" role="banner">
  <div class="container">
    <div class="navbar-header">
      <button class="navbar-toggle" type="button" data-toggle="collapse" data-target=".bs-navbar-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a href="/" class="navbar-brand">
        <img src="/styles/images/logo.jpg">
      </a>
    </div>
    <nav class="collapse navbar-collapse bs-navbar-collapse" role="navigation">
      <ul class="nav navbar-nav">    
        <li>
          <a href="/">Home</a>
        </li>
        <li>
          <a href="/categories/">分类</a>
        </li>
        <li>
          <a href="/tag">标签</a>
        </li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
          <a href="/donate/"><strong>打赏</strong></a>
        </li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown">关于<b class="caret"></b></a>
          <ul class="dropdown-menu">
            <li><a rel="nofollow" target="_blank" href="https://github.com/liuqibao566">Github</a></li>
            <li><a rel="nofollow" target="_blank" href="">关于作者</a></li>
            <li><a rel="nofollow" href="/books">书架</a></li>
            <li><a rel="nofollow" href="/reference">相关链接</a></li>
            <li><a href="/feed.xml">RSS订阅</a></li>
            <li class="divider"></li>
            <li><a rel="nofollow" target="_blank" href="https://github.com/liuqb566/">本项目</a></li>
          </ul>
        </li>
      </ul>
    </nav>
  </div>
</header>

    <div class="docs-header" id="content">
  <div class="container">
  	
  		<!--
		    <h1>RNA-seq 中的基因表达量计算和表达差异分析</h1>
		    <p>Post on Apr 06, 2017 by <a href="/about">Gossie</a></p>
		-->
		    <h1></h1>
    
  </div>
</div>
    
      
<div class="banner">
  <div class="container">
  	
    	<a href="/categories/#bioinformatics-ref">bioinformatics</a>	/
    	<a href="/tag/#RNA-seq-ref">RNA-seq</a>
    
  </div>
</div>

    

    <div class="container docs-container">
  <div class="row">
    <div class="col-md-3">
      <div class="sidebar hidden-print" role="complementary">
        <div id="navigation">
  <h1>目录</h1>
  <ul class="nav sidenav">
<!--
    
      
      
      
      

      
        <li><a href="#year_2017">2017</a>
          <ul class="nav">
            <li><a href="#month_2017_June">June</a></li>
      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
              <li><a href="#month_2017_May">May</a></li>
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
              <li><a href="#month_2017_April">April</a></li>
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
              <li><a href="#month_2017_March">March</a></li>
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
              <li><a href="#month_2017_February">February</a></li>
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
              <li><a href="#month_2017_January">January</a></li>
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
        
            </ul>
          </li>
          <li><a href="#year_2016">2016</a>
            <ul class="nav">
              <li><a href="#month_2016_December">December</a></li>
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
              <li><a href="#month_2016_November">November</a></li>
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            
          
        
      
    
      
      
      
      

      

      
            </ul>
          </li>
      
    
-->
  </ul>
</div> 
      </div>
    </div>
    <div class="col-md-9" role="main">
      <div class="panel docs-content">
        <div class="wrapper">
            <header class="post-header">
              <h1 class="post-title">RNA-seq 中的基因表达量计算和表达差异分析</h1>
              <!--
                <p class="post-meta">Apr 6, 2017</p>
              -->
              <div class="meta">Posted on <span class="postdate">Apr 06, 2017</span> By <a target="_blank" href="http://liuqibao.me">Gossie</a></div>
              <br />
            </header>
            <article class="post-content">
              <ul id="markdown-toc">
  <li><a href="#section" id="markdown-toc-section">归一化</a></li>
  <li><a href="#section-1" id="markdown-toc-section-1">差异分析算法及比较</a></li>
  <li><a href="#section-2" id="markdown-toc-section-2">差异分析的方法以及比较</a></li>
</ul>

<h4 id="section">归一化</h4>

<p>一、原因
1. 基因长度
2. 测序深度（建库大小）
3. 样本特异性
二、差异分析基于的假设
1. 不同样本基因总表达量相似
2. 上调差异表达与下调差异表达整体数量相似（上下调差异平衡）
3. 两组样本中不受处理效应影响的基因，表达量相似（差异不显著）。
4. 看家基因可作为表达量评价的依据（待定）</p>

<p>三、不同算法
1. 以什么数值来衡量表达量
RPKM、FPKM、TPM
2. 以什么作为参照标准
TMM（edgeR）、Deseq 矫正</p>

<p>RPKM：read
FPKM：fragment
TMP：transcript</p>

<p>问题：mRNA 总量未必相等
1. mRNA 总量不等-细胞本身不同
2. mRNA 总量不等-污染</p>

<p>解决方法-不同算法方法
不同的归一化算法（参照系）：
1. Total Count（TC）：总 reads 数矫正
2. Upper Quartile（UQ）
3. Median（Med）：
4. Quantile（Q）：基因芯片软件 limma 算法
5. RPKM：总 reads 数，引入了基因长度
6. 中位数：Deseq 算法
7. TMM：edgeR 算法</p>

<p>Deseq：
1. 理论上更加稳定
2. 不同批次的比较会得到不同的表达量值，不利于进行多处理组/批次数据的统一分析（如，趋势分析、共表达分析）
3. 校正会掩盖一些问题（如，样本污染）</p>

<p>RPKM算法：
1. 易受异常高表达基因、外源污染等干扰
2. 也容易发现问题
3. 得到的表达量值恒定，多处理组/批次的数据可以合并分析</p>

<p>折中方法：RPKM 类算法，但要人工检查数据是否异常
Deseq 也可以关闭校正功能</p>

<ol>
  <li>实际经验，RPKM 比较稳定，但是要排除异常值（高表达基因、外源污染）</li>
  <li>细胞本身不同（如对照组实验组来自不同的组织或器官），可以用二次矫正（如，RT-PCR 定量内参基因（看家基因等），用内参基因二次矫正）。</li>
</ol>

<hr />
<p>个人见解：
RPKM/FPKM：对基因长度和测序深度做了归一化
TPM：对基因长度和细胞的 mRNA 含量做了归一化
所以，
1. 当测序深度一致、细胞 mRNA 含量相似时，两种方法都可以
2. 当样本的测序深度不同时建议用 FPKM
3. 当样本的 mRNA 含量差异很大（对照组与实验组来自不同的器官、组织），建议用 TPM；若用 RPKM，再用内参基因（RT-PCR 管家基因）二次矫正，似乎也可选。
3. 当样本的测序深度和 mRNA 含量都不同时，建议放弃实验吧
—–</p>

<h4 id="section-1">差异分析算法及比较</h4>

<p>一、基础理解：处理效应与误差效应
组内差异：误差效应
组间差异：误差效应+处理效应
处理平均方差 = 处理组间个体间的平均差异程度
训闫平均方差 = 处理内个体间的平均差异程度
检验的本质：处理效应 = 组间平均差异 - 组内平均差异 &gt; 0
通常情况下，如果没有重复，组内差异则无法计算。</p>

<p>差异显著性：通过组内差异和组间差异的比较，是否显著</p>

<p>二、基础延伸：二项分布、泊松分布</p>

<p>三、基础假设
Read 在基因组上的分布：泊松分布。即，如果两组样本（没有重复），那么期望的测序深度（表达量均值）和（误差方差 = np）都可以估算出来。</p>

<p>基因差异表达分析判断的过程：
1. 组内和组间差异的估算
组间差异：处理组之间的差异；
组内（误差）差异：即测序的随机误差，利用泊松分布公式计算出来，不依赖于重复样本。
2. 组间差异是否大于误差差异；</p>

<p>RNA-seq 没有重复，依然可以进行差异检验的原因：利用公式预估测序随机误差的大小。</p>

<h4 id="section-2">差异分析的方法以及比较</h4>

<p>一、实际生物学实验</p>

<ul>
  <li>误差效应：技术误差 + 生物学差异</li>
  <li>组间差异：生理效应 + 误差效应</li>
</ul>

<p>二、混合分布</p>

<p>技术误差：泊松分布
生物差异：伽马分布
生物学重复样本间的误差分布则符合：泊松分布 + 伽马分布 = 负二项分布
ν = μ + αμ^2
ν：方差；μ，均值；α，散度因子</p>

<p>edgeR 和 Deseq 都使用负二项分布，但对散度因子的估算方式不相同，所以最后的 P 值不同。</p>

<p>Read count 带来的误差
计算多重比对的 read要，在重新分配这类 reads 过程中，会引入误差，则：
- 生物学生物误差分布 = 负二项分布
- 多重比较对 reads 分配误差 = β 分布</p>

<p>生物学重复的转录本 reads 估计 = β 分布 + 负二项分布 = β 负二项分布（新版本 cuffdiff（v2）使用该假设）</p>

<p>小结和比较–三种分布
- 不同的差异分析方法的本质区别：对随机误差的估算方法
- 最早的流程：使用泊松分布，只考虑技术重复的误差（因此可以不测重复）。
- 后续开发的软件（Deseq、edgeR），使用负二项分布（泊松分布 + γ 分布），考虑技术重复误差和生物个体差异；
- 再后来开发的软件（cuffdiff），使用 β 负二项分布（泊松分布 + γ 分布 + β 分布），考虑对多重比对 reads 估算过程中的误差。</p>

<p>误差方差估算值：泊松分布 &lt; 负二项分布 &lt; β 负二项分布
显著性：泊松分布 &gt; 负二项分布 &gt; β 负二项分布</p>

<p>Deseq 软件方差估计的方法</p>

<ol>
  <li>为什么使用 reads counts 作为输入
误差 = 测序误差（泊松分布） + 生物学差异（γ 分布）
生物差异相对固定。技术差异只与期望测序深度有关。所以每个基因的估算值不同。而且这个数值只能使用 reads 数来估算。
被测到的概率：期望测到的 reads 数（均值）/总 reads 数</li>
</ol>

<p>所以，差异分析松有需要心 reads 数为输入，计算测序导致的随机误差，而不是 RPKM 值。使用 RPKM 对低丰度基因的估算不准确。</p>

<ol>
  <li>使用 reads counts 作为输入
误差 = 技术误差（泊松分布） + 生物学差异（γ 分布）</li>
</ol>

<p>表达量高的基因，生物学差异为主。
表达量低的基因，技术差异为主（reads count要数太低，导致定量不稳定），相对变异更大。所以，低表达的基因通常差异不显著。</p>

<ol>
  <li>误差拟合</li>
</ol>

<p>dispersion（离散系数），相当于标准差。在重复样本数很少时（2——3 个），单个基因的标准差估算误差很大，所以通过拟合，计算在特定表达量水平的基因的标准差均值。</p>

<p>四、不同方法在实际情况的应用</p>

<ol>
  <li>组内差异过大为什么则找不到差异基因？
组内差异大，组间误差和组内误差比不显著，即得出组间没有差异</li>
</ol>

<p>在此情况下，只能更加宽松的方法
1）换用统计方法
例如泊松分布，但实际上假阳性会提高，并没有改变误差组成，自欺欺人。
2）改变阈值
降低阈值（PDR 值 &lt; 0.025）
3）剔除离群样本（如果重复数 ≧ 3）
4）别太信 p value（在没有生物学重复时，p 值可能不够小，可以适当降低阈值）
5）组内差异太大，可以考混样。</p>

<ol>
  <li>
    <p>方差分析中，低丰度基因的 P 值被低估，生出差异的结论不可靠。</p>
  </li>
  <li>
    <p>1）要想得到更多差异基因：
老流程（泊松分布）&gt; deseq、edgeR（负二项分布）&gt; cuffdiff（β 负二项分布）</p>
  </li>
</ol>

<p>2）cuffdiff 可以良好的控制假阳性，但也会带来大量假阴性，而且这个软件也有 bug。
3）旧的泊松分布流程，FDR 一般使用 0.1%，而新的流程，一般使用 1%。</p>

<hr />
<p>P value 本身受使用的数学模型以及样本的数量影响非常大。
现在转录组的数据都要求生物学重复，无生物物学重复，一般使用 R 包 DEGseq 和 edgeR 的泊松分布，好像 cuffdiff 的 <code class="highlighter-rouge">--dispersion-method blind</code> 方法也可以用于无重复数据，但是当样本差异表达基因很多时，这种建模方式可能找不到显著的基因。</p>

            </article>
        </div>
      </div>
      <div class="panel docs-content">
        <article class="post-content">
          <div class="wrapper">
            


  <div class="ds-thread" data-thread-key="/2017/04/06/RNA-seq-gene-difficultily-expression-analysis-DENOVO/" data-title="RNA-seq 中的基因表达量计算和表达差异分析" data-url="http://liuqibao.me/2017/04/06/RNA-seq-gene-difficultily-expression-analysis-DENOVO/"></div>

<script type="text/javascript">
var duoshuoQuery = {short_name:"Gossie"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
</script>


 
          </div>
        </article>
      </div>
    </div>
  </div>
</div>

    
    <footer class="footer" role="contentinfo">
	<div class="container">
		<p class="copyright">Copyright &copy; 2014-2017 <a href=""><code>Gossie</code></a>.</p>
		<p>Site powered by <a href="http://jekyllrb.com">Jekyll</a> && <a href="http://www.github.com">Github</a></p>
	</div>
</footer>

<script src="/styles/js/jquery.min.js"></script>
<script src="/styles/js/bootstrap.min.js"></script>
<script src="/styles/js/holder.min.js"></script>
<script src="/styles/js/application.js"></script>
<script src="/styles/js/lessismore.js"></script>


  </body>
</html>
