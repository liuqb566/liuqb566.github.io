<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title></title>
    <description>好记性不如写博文！</description>
    <link>http://liuqibao.me/</link>
    <atom:link href="http://liuqibao.me/feed.xml" rel="self" type="application/rss+xml"/>
    <pubDate>Mon, 16 Oct 2017 19:52:43 +0800</pubDate>
    <lastBuildDate>Mon, 16 Oct 2017 19:52:43 +0800</lastBuildDate>
    <generator>Jekyll v3.6.0</generator>
    
      <item>
        <title>Parameter About Gragh In R</title>
        <description>&lt;h2 id=&quot;r-&quot;&gt;R 语言基础作图函数画图常用的参数&lt;/h2&gt;

&lt;p&gt;在 linux 上修图比较麻烦，因为没有 PS，没有 AI，而且 GIMP 又不会用，所以决定尝试直接用 R 生成最终的图片，所幸结果还可以。
图片格式、大小、分辨率都可以在 png、tiff、jpep 等指定。&lt;/p&gt;

&lt;h3 id=&quot;par&quot;&gt;图片布局用 par（）函数&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;mfrow/mfcol：设定图片的填充顺序，行/列，例如，mfrow=c（2，3），表示按行填充，两行三列&lt;/li&gt;
  &lt;li&gt;mgp：mgp=c（2.5,1,0）,第一个参数是坐标轴（边框）到轴标签的距离，单位是标签字符的大小；第二个参数是坐标轴到刻度的距离，第三个参数是与实际坐标轴的距离。&lt;/li&gt;
  &lt;li&gt;mar：mar=c（6，6，3，3），分别为下左上右的边距&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;如果需要调整标签大小，最好同时调整 mgp 和 mar 参数，否则标签太大会显示不完整；一般标签在 x 轴和 y 轴，所以下左可以稍大些。
这些参数也可以用在 png（）、jpeg（）等函数中&lt;/p&gt;

&lt;h3 id=&quot;section&quot;&gt;图片坐标轴和文字属性都有参数可以设定，如：&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;xlim、ylim&lt;/li&gt;
  &lt;li&gt;title&lt;/li&gt;
  &lt;li&gt;xlab&lt;/li&gt;
  &lt;li&gt;ylab&lt;/li&gt;
  &lt;li&gt;bty：设定边框&lt;/li&gt;
  &lt;li&gt;cex：点或线的大小&lt;/li&gt;
  &lt;li&gt;cex.axis：刻度大小&lt;/li&gt;
  &lt;li&gt;cex.lab：轴标签的大小&lt;/li&gt;
  &lt;li&gt;col&lt;/li&gt;
  &lt;li&gt;las：坐标方向（垂直或平行于坐标轴，0 或 1）
…
这里主要介绍 mtext，它可以向生成后的图片添加文本
&lt;code class=&quot;highlighter-rouge&quot;&gt;
mtext(text, side = 3, line = 0, outer = FALSE, at = NA,
    adj = NA, padj = NA, cex = NA, col = NA, font = NA, ...）
&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;几个常用参数
- text：要添加的文本，用 “” 引起来
- side：在哪边输出文本，1234，代表下左上右
- line：在距边框的距离，负数为向内
- adj：0 表示左对齐或下对齐，1 表示右对齐或上对齐
- at: 指定字符串的起始位置，例如 at=0.5，起始字符串与 x 轴 0.5 刻度对应，可以与 adj 搭配使用
- cex：字体大小
…&lt;/p&gt;

&lt;p&gt;需要注意的是，字符串大小不会与图片的大小同步调节，所以要多次尝试，找一个合适的大小。&lt;/p&gt;

</description>
        <pubDate>Tue, 16 May 2017 00:00:00 +0800</pubDate>
        <link>http://liuqibao.me/2017/05/16/parameter-about-gragh-in-R/</link>
        <guid isPermaLink="true">http://liuqibao.me/2017/05/16/parameter-about-gragh-in-R/</guid>
        
        
      </item>
    
      <item>
        <title>fastqc 软件的简单使用和结果解读</title>
        <description>&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#section&quot; id=&quot;markdown-toc-section&quot;&gt;简单使用&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-1&quot; id=&quot;markdown-toc-section-1&quot;&gt;结果&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#section-2&quot; id=&quot;markdown-toc-section-2&quot;&gt;基础统计&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-3&quot; id=&quot;markdown-toc-section-3&quot;&gt;每个碱基的测序质量&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#per-sequence-quality-scores&quot; id=&quot;markdown-toc-per-sequence-quality-scores&quot;&gt;Per Sequence Quality Scores&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#per-base-sequence-content&quot; id=&quot;markdown-toc-per-base-sequence-content&quot;&gt;Per Base Sequence Content&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#per-sequence-gc-&quot; id=&quot;markdown-toc-per-sequence-gc-&quot;&gt;Per Sequence GC 含量&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#per-base-n-content&quot; id=&quot;markdown-toc-per-base-n-content&quot;&gt;Per Base N Content&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#sequence-length-distribution&quot; id=&quot;markdown-toc-sequence-length-distribution&quot;&gt;Sequence Length Distribution&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#duplicate-sequences&quot; id=&quot;markdown-toc-duplicate-sequences&quot;&gt;Duplicate Sequences&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#overrepresented-sequences&quot; id=&quot;markdown-toc-overrepresented-sequences&quot;&gt;Overrepresented Sequences&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#adapter-content&quot; id=&quot;markdown-toc-adapter-content&quot;&gt;Adapter Content&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#kmer-content&quot; id=&quot;markdown-toc-kmer-content&quot;&gt;Kmer Content&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#per-tile-sequence-quality&quot; id=&quot;markdown-toc-per-tile-sequence-quality&quot;&gt;Per Tile Sequence Quality&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;section&quot;&gt;简单使用&lt;/h3&gt;

&lt;p&gt;fastqc 是一个高能量测序数据 QC 分析工具。
作用命令：
&lt;code class=&quot;highlighter-rouge&quot;&gt;
fastqc seqfile1 seqfile2 ... seqfileN
fastqc fastqc [-o output dir] [--(no)extract] [-f fastq|bam|sam] [-c contaminant file] seqfile1 .. seqfileN
&lt;/code&gt;
options：
-o：将结果输出到指定文件夹。注意，文件夹必须已存在，程序不会自己创建文件夹。
–casava：输入数据为 casava 数据
–nano：输入数据为 naopore 序列数据，fast5 格式。
–extract：输出文件不压缩，默认为压缩
–noextract：压缩输出文件，如果在非交互式界面建议这样做。
-f：强制指定输入文件格式，默认自动识别。可用格式有：bam,sam,bam_mapped,sam_mapped,fastq
-t：多线程控制。注意，每个线程需要 250M 内存，请合理使用。32 位的系统不能多于 6 个线程。
-c：污染物选项，非默认选项
-a：接头文件，非默认选项
-l：自定义评估标准，也可以删除某些评估项目。
-k: 调节 kmers 设定某特定短序列的长度，范围 2-10，默认 7.
-q：沉默模式，仅报告错误，不输出标准输出
-d：设置存储产生图片时的临时文件的文件夹，默认 /temp&lt;/p&gt;

&lt;h3 id=&quot;section-1&quot;&gt;结果&lt;/h3&gt;

&lt;h4 id=&quot;section-2&quot;&gt;基础统计&lt;/h4&gt;

&lt;ul&gt;
  &lt;li&gt;Filename&lt;/li&gt;
  &lt;li&gt;File type：常规碱基还是 colorspace 序列，后者需要转换为常规碱基。&lt;/li&gt;
  &lt;li&gt;Encoding：Q 值的 ASCII 编码版本&lt;/li&gt;
  &lt;li&gt;Total Sequences：有两个值，一个实际值，一个估计值，目前来说一样，软件还没找到好的估计方法。&lt;/li&gt;
  &lt;li&gt;Filtered Sequences：在 Casava 模式下运行时过滤的 flag 序列数，这项结果不在上一项 Total Sequences中，也不在以后的分析中&lt;/li&gt;
  &lt;li&gt;Sequence Length：显示最长和最短 read 长度，如果所有长度一致，只显示一个值。&lt;/li&gt;
  &lt;li&gt;%GC：所有序列所有碱基的 %GC。&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;section-3&quot;&gt;每个碱基的测序质量&lt;/h4&gt;

&lt;p&gt;&lt;img src=&quot;../image/fastqc_image/per_base_sequence_content.png&quot; alt=&quot;&quot; /&gt;
1. Summary
展示 FastQ 文件每个位置每个碱基的质量范围。箱线图
- 中间的红线是中位数
- 蓝线是平均数&lt;/p&gt;

&lt;p&gt;y 轴代表质量分数，前景分为不同的颜色：
- 绿色：非常好
- 橘色：合格
- 红色：很差。
一般测序的质量会随测序长度逐渐降低。&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;Warning
碱基下四分位数小于 10，或者中位数小于 25.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Failure&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;碱基下四分位数质量小于 5，或者中位数小于 20.&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;揭示 warnings 的常见原因&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;最常见的原因是随测序的进行，质量逐渐下降。
通常可以通过软件剪掉一部分碱基。
没有去接头。
另一个原因有可能是因为测序过程中，run 短暂的出现问题，可以通过比较每个 tile 的质量图查看错误类型。可以考虑先 amsking 碱基，再比对。
如果 read 长度不一，可能会报错，因为某个碱基的覆盖度可能很低，下一步分析前，你需要查看哪些序列出了问题。&lt;/p&gt;

&lt;h3 id=&quot;per-sequence-quality-scores&quot;&gt;Per Sequence Quality Scores&lt;/h3&gt;

&lt;p&gt;&lt;img src=&quot;../image/fastqc_image/per_sequence_quality.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Summary
每条 read 的质量分数。通常由于测序机器原因，总有部分 reads 质量不好，但应该只占一小部分。
如果一个 run 中的测序结果有明显的一部分质量较低，可能是系统原因，可能是某个 flowcell 的问题。&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;y 轴：reads 数
x 轴：质量&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Warning&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;平均值小于 27（=0.2% 错误率）&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Failure&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;均值小于 20（=1% 错误率）&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;常见原因&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;This module is generally fairly robust and errors here usually indicate a general loss of quality within a run. For long runs this may be alleviated through quality trimming. If a bi-modal, or complex distribution is seen then the results should be evaluated in concert with the per-tile qualities (if available) since this might indicate the reason for the loss in quality of a subset of sequences.&lt;/p&gt;

&lt;h3 id=&quot;per-base-sequence-content&quot;&gt;Per Base Sequence Content&lt;/h3&gt;

&lt;p&gt;&lt;img src=&quot;../image/fastqc_image/per_base_sequence_content.pn&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Summary&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;reads 的每个位置的每种碱基比例。
y 轴：百分比
x 轴：read 位置&lt;/p&gt;

&lt;p&gt;在随机库中，理想结果为 4 各碱基比率相同（25%），为一条直线。
值得注意的是，一些类型的库碱基比例会出现偏差，通常是在 read 的开始位置。这是由于系统原因造成的，包括 RNA-seq。虽然这是一个技术偏差，而且也不会对下游分析造成影响，但是，本模块还是会给出警告。&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Warnning&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;任何位置 A 和 T，或者 G 和 C 的差异大于 10%&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Failure&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;任何位置 A 和 T，或者 G 和 C 的差异大小 20%&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;常见原因&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;有以下几个常见原因：
1&amp;gt; Overrepresented sequences：如接头或者 rRNA
2&amp;gt; Biased fragmentation：由于系统的随机选择偏差，导致每个 run 的前 12bp 可能有偏差。
3&amp;gt; Biased composition libraries: 一些库的组成有偏差，比如经过了亚硫酸钠处理等，虽然对这个库很正常，但是模块会给出警告。
4&amp;gt; 如果库已过了去接头处理，可能会引起虚假的偏差，因为已经比对需要的接头已经去除了。&lt;/p&gt;

&lt;h3 id=&quot;per-sequence-gc-&quot;&gt;Per Sequence GC 含量&lt;/h3&gt;
&lt;p&gt;&lt;img src=&quot;../image/fastqc_image/per_sequence_gc_content.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;Summary
每条 read 的 GC 含量分布与正常分布的比较
y 轴：read 数
x 轴：GC%&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Warning&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;15% reads 有偏差&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Failure&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;30% 的 reads 有偏差。&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;常见原因&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;由于污染或者系统误差造成。&lt;/p&gt;

&lt;h3 id=&quot;per-base-n-content&quot;&gt;Per Base N Content&lt;/h3&gt;

&lt;p&gt;&lt;img src=&quot;../image/fastqc_image/per_base_n_content.png&quot; alt=&quot;&quot; /&gt;&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Summary&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;如果不能识别某位置是什么碱基，会标为 N
该模块统计每个位置 N 的比例
y 轴：位置
x 轴：N 比例
正常情况下为一条直线，可能在末端有时会有突起。&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Warning&lt;/li&gt;
&lt;/ol&gt;

&lt;blockquote&gt;
  &lt;p&gt;5%&lt;/p&gt;
&lt;/blockquote&gt;

&lt;ol&gt;
  &lt;li&gt;Failure&lt;/li&gt;
&lt;/ol&gt;

&lt;blockquote&gt;
  &lt;p&gt;20%&lt;/p&gt;
&lt;/blockquote&gt;

&lt;ol&gt;
  &lt;li&gt;常见原因&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;一个最可能的原因是某个位置的覆盖度比较低。
在测序质量很好的背景下有少部分位置发生高的 N 含量，可能是因为序列的组成有偏差，可以在 per-base-sequence-content 结果中查看。&lt;/p&gt;

&lt;h3 id=&quot;sequence-length-distribution&quot;&gt;Sequence Length Distribution&lt;/h3&gt;
&lt;p&gt;![../image/fastqc_image/sequence_length_distribution.png]
1. Summary
x 轴：reads 长度
y 轴：reads 数&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Warning
长度不一&lt;/li&gt;
  &lt;li&gt;Failure
有长度为 0&lt;/li&gt;
  &lt;li&gt;常见原因
有些平台的 reads 长度就量不一样，不用管它。&lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&quot;duplicate-sequences&quot;&gt;Duplicate Sequences&lt;/h3&gt;
&lt;p&gt;1&lt;a href=&quot;../image/fastqc_image/duplication_levels.png&quot;&gt;&lt;/a&gt;&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;Summary
一个低的 duplication 表明覆盖度较高，但是过高的 duplication 表明有富集偏差（如，PCR 过量扩增）。
y 轴：duplicated reads 数
x 轴：duplication 次数
无重复 reads 数为 100%
为了减少内存占用，仅对前100,000条不重复序列进行统计。
为了简化结果形式，对于多于10次重复的序列会人为地将其重复次数设定为10，因此结果图像上曲线会显示一个小的翘尾。
对于&amp;gt;75bp的序列，将其截短为前50bp进行统计，因相对而言长序列会包含较多测序错误而倾向于产生过多的统计重复。&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;Warning
非唯一序列大于 20%&lt;/li&gt;
  &lt;li&gt;Failure
非唯一序列大于 50%&lt;/li&gt;
  &lt;li&gt;常见原因
一般有两个原因：技术重复（PCR 扩增）、生物重复（不同拷贝）&lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&quot;overrepresented-sequences&quot;&gt;Overrepresented Sequences&lt;/h3&gt;

&lt;ol&gt;
  &lt;li&gt;Summary
为了优化运算仅对前100,000条序列进行运算，将重复比例在所有序列中的占比&amp;gt;0.1%的结果进行列表输出，并且对其与常见的测序实验中使用的adapter等序列进行比对，比对时要求一致性长度&amp;gt;20p且无任何错配。&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;对于&amp;gt;75bp的序列，将其截短为前50bp进行比对
2. Warning
重复序列大于 0.1%
3. Failure
重复序列大于 1%
4. 常见原因&lt;/p&gt;

&lt;h3 id=&quot;adapter-content&quot;&gt;Adapter Content&lt;/h3&gt;

&lt;ol&gt;
  &lt;li&gt;Summary&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;接头序列统计
2. Warning
任何序列出现在 5% 的 reads 中
3. Failure
任何序列出现在 10% 的 reads 中&lt;/p&gt;

&lt;h3 id=&quot;kmer-content&quot;&gt;Kmer Content&lt;/h3&gt;

&lt;ol&gt;
  &lt;li&gt;Summary
overrepresented sequence 并不总是有效，例如：
1）如低质量的长 reads，由于随机的测序错误会降低过表达序列统计数
2）如果小片段序列在不同的位置出现也不会以被统计到&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;Kmer意为连指定长度为K的连续碱基
此部分的Kmer默认为连续7个碱基组成的一个单元，即任意一个碱基与其后相连的六个碱基构成了一个Kmer。
按read的位点逐一统计每一个位点的所有Kmer的情况，并在结果图中给出了前六个过表达的Kmer及其在read上的位点分布情况。
如果某k个bp的短序列在reads中大量出现，其频率高于统计期望的话，fastqc将其记为over-represente&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Warninn&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;p &amp;lt; 0.01&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Failure&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;P &amp;lt; 10^5&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;常见原因&lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&quot;per-tile-sequence-quality&quot;&gt;Per Tile Sequence Quality&lt;/h3&gt;
&lt;p&gt;&lt;img src=&quot;../image/fastqc_image/per_tile_quality.png&quot; alt=&quot;&quot; /&gt;
1. Summary
该模块展示 Illumina 测序的每个 flowcell tile 的结果，这样就可以直接看到是哪个 tile 的测序有问题。
冷色表示该 tile 的质量大于等于相应 run 的平均质量，热色系表示小于平均质量。总之，越蓝越好，越红越差。
y 轴：tile 编号
x 轴：read 位置&lt;/p&gt;

&lt;p&gt;产生的问题可能是由于暂时性问题，如有气泡，或者长时间的问题，如 flowcell 的壁上有污迹。&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Warning
Phred score 低于均值的有 2 个&lt;/li&gt;
  &lt;li&gt;Failure
Phred score 低于均值的有 5 个&lt;/li&gt;
  &lt;li&gt;常见原因&lt;/li&gt;
&lt;/ol&gt;

</description>
        <pubDate>Wed, 26 Apr 2017 00:00:00 +0800</pubDate>
        <link>http://liuqibao.me/2017/04/26/fastqc-introdution-and-result/</link>
        <guid isPermaLink="true">http://liuqibao.me/2017/04/26/fastqc-introdution-and-result/</guid>
        
        <category>使用手册</category>
        
        
        <category>bioinformatics</category>
        
      </item>
    
      <item>
        <title>## vcftools 的简单使用</title>
        <description>&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#section&quot; id=&quot;markdown-toc-section&quot;&gt;1. 安装&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-1&quot; id=&quot;markdown-toc-section-1&quot;&gt;2. 使用&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#section-2&quot; id=&quot;markdown-toc-section-2&quot;&gt;2.2. 位点过滤参数：&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-3&quot; id=&quot;markdown-toc-section-3&quot;&gt;2.3. 样本过滤参数&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-4&quot; id=&quot;markdown-toc-section-4&quot;&gt;2.4. 基因型过滤参数&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-5&quot; id=&quot;markdown-toc-section-5&quot;&gt;2.5. 输出参数&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-6&quot; id=&quot;markdown-toc-section-6&quot;&gt;2.6. 比较参数&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;vcftools 是用于 VCF 和 BCF 格式的遗传变异数据的工具包。
它的功能主要有数据统计、运行数据计算、数据过滤、数据转换。&lt;/p&gt;

&lt;h3 id=&quot;section&quot;&gt;1. 安装&lt;/h3&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;git clone https://github.com/vcftools/vcftools.git
cd vcftools
./autogen.sh
./configure
make
make install
&lt;/div&gt;
&lt;p&gt;如果是非 root 用户，可以使用：`./configure prefix=’Your path’&lt;/p&gt;

&lt;h3 id=&quot;section-1&quot;&gt;2. 使用&lt;/h3&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;vcftools [ --vcf FILE | --gzvcf FILE | --bcf FILE] [ --out OUTPUT PREFIX ] [ FILTERING OPTIONS ] [ OUTPUT OPTIONS ]
&lt;/div&gt;
&lt;p&gt;#### 2.1. 基本参数：
- 输入文件参数：
–vcf &lt;输入文件&gt;：输入文件可以是 VCF 格式 v4.0、v4.1 和 v4.2。’-‘ 用于标准输入
--gzvcf &lt;输入文件&gt;： 读入 gzipped 压缩文件
--bcf &lt;输入文件&gt;：读入 BCF2 文件。
- 输出文件参数：
--out &lt;输出文件&gt;：所有输出文件的文件名前缀。如果忽略，默认为 ’out.'
--stdout
-c：输出为标准输出
-temp &lt;temp_文件&gt;：将 vcftools 产生的所有临时文件输入到指定目录。&lt;/temp_文件&gt;&lt;/输出文件&gt;&lt;/输入文件&gt;&lt;/输入文件&gt;&lt;/输入文件&gt;&lt;/p&gt;

&lt;h4 id=&quot;section-2&quot;&gt;2.2. 位点过滤参数：&lt;/h4&gt;

&lt;ul&gt;
  &lt;li&gt;位置过滤
–chr &lt;chromosome&gt; 
--not-chr &lt;chromosome&gt;&lt;/chromosome&gt;&lt;/chromosome&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;匹配或者不匹配某条染色体。可能多次使用该参数，以设定多条染色体。&lt;/p&gt;

&lt;p&gt;–from-bp &lt;integer&gt; 
--to-bp &lt;integer&gt;&lt;/integer&gt;&lt;/integer&gt;&lt;/p&gt;

&lt;p&gt;设定碱基的位置范围，仅与 &lt;code class=&quot;highlighter-rouge&quot;&gt;--chr&lt;/code&gt; 结合使用。可以只使用一个。&lt;/p&gt;

&lt;p&gt;–positions &lt;filename&gt; 
--exclude-positions &lt;filename&gt;&lt;/filename&gt;&lt;/filename&gt;&lt;/p&gt;

&lt;p&gt;使用或者不使用文件中的某些位置的碱基。输入文件的每行用 &lt;code class=&quot;highlighter-rouge&quot;&gt;\t&lt;/code&gt; 制表符分隔，允许加注释行，用 ‘#’ 开头。&lt;/p&gt;

&lt;p&gt;–positions-overlap &lt;filename&gt; 
--exclude-positions-overlap &lt;filename&gt;&lt;/filename&gt;&lt;/filename&gt;&lt;/p&gt;

&lt;p&gt;排除或者不排除文件中与参考等位基因重叠的碱基。&lt;/p&gt;

&lt;p&gt;–bed &lt;filename&gt; 
--exclude-bed &lt;filename&gt;&lt;/filename&gt;&lt;/filename&gt;&lt;/p&gt;

&lt;p&gt;Include or exclude a set of sites on the basis of a BED file. Only the first three columns (chrom, chromStart and chromEnd) are required. The BED file is expected to have a header line. A site will be kept or excluded if any part of any allele (REF or ALT) at a site is within the range of one of the BED entries.&lt;/p&gt;

&lt;p&gt;–thin &lt;integer&gt;&lt;/integer&gt;&lt;/p&gt;

&lt;p&gt;Thin sites so that no two sites are within the specified distance from one another.&lt;/p&gt;

&lt;p&gt;–mask &lt;filename&gt; 
--invert-mask &lt;filename&gt; 
--mask-min &lt;integer&gt;&lt;/integer&gt;&lt;/filename&gt;&lt;/filename&gt;&lt;/p&gt;

&lt;p&gt;These options are used to specify a FASTA-like mask file to filter with. The mask file contains a sequence of integer digits (between 0 and 9) for each position on a chromosome that specify if a site at that position should be filtered or not. 
An example mask file would look like:
&lt;code class=&quot;highlighter-rouge&quot;&gt;
&amp;gt;1 
0000011111222... 
&amp;gt;2 
2222211111000...
&lt;/code&gt;
In this example, sites in the VCF file located within the first 5 bases of the start of chromosome 1 would be kept, whereas sites at position 6 onwards would be filtered out. And sites after the 11th position on chromosome 2 would be filtered out as well. 
The “–invert-mask” option takes the same format mask file as the “–mask” option, however it inverts the mask file before filtering with it. 
And the “–mask-min” option specifies a threshold mask value between 0 and 9 to filter positions by. The default threshold is 0, meaning only sites with that value or lower will be kept.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;位点过滤&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;–snp &lt;string&gt;&lt;/string&gt;&lt;/p&gt;

&lt;p&gt;包含一个 SNP 位点，如 dbSNP 的 rsID。可以使用多次。&lt;/p&gt;

&lt;p&gt;–snps &lt;filename&gt; 
--exclude &lt;filename&gt;&lt;/filename&gt;&lt;/filename&gt;&lt;/p&gt;

&lt;p&gt;使用或者不使用文件中给出的 SNPs。文件包含一列 SNP IDs （如 dbSNP rsIDs），每行一个，不需要表头。&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;变异类型过滤
–keep-only-indels 
–remove-indels&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;使用或者不使用一个 indel。indel 表示任何与参考等位基因长度不同的变异。&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;FILTER flag 过滤
–remove-filtered-all&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;根据 vcf 文件中的 FILTER flag 过滤，除了 PASS。&lt;/p&gt;

&lt;p&gt;–keep-filtered &lt;string&gt; 
--remove-filtered &lt;string&gt;&lt;/string&gt;&lt;/string&gt;&lt;/p&gt;

&lt;p&gt;使用或者不使用 FILTER flag 标记的所有位点。可以多次使用该参数。&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;根据 INFO 过滤&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;–keep-INFO &lt;string&gt; 
--remove-INFO &lt;string&gt;&lt;/string&gt;&lt;/string&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;根据 ALLELE 过虑&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;–maf &lt;float&gt; ：过滤大于等于该 MAF 的位点
--max-maf &lt;float&gt;：过滤小于等于该 MAF 的位点。&lt;/float&gt;&lt;/float&gt;&lt;/p&gt;

&lt;p&gt;–non-ref-af &lt;float&gt; 
--max-non-ref-af &lt;float&gt; 
--non-ref-ac &lt;integer&gt; 
--max-non-ref-ac &lt;integer&gt;&lt;/integer&gt;&lt;/integer&gt;&lt;/float&gt;&lt;/float&gt;&lt;/p&gt;

&lt;p&gt;–non-ref-af-any &lt;float&gt; 
--max-non-ref-af-any &lt;float&gt; 
--non-ref-ac-any &lt;integer&gt; 
--max-non-ref-ac-any &lt;integer&gt;&lt;/integer&gt;&lt;/integer&gt;&lt;/float&gt;&lt;/float&gt;&lt;/p&gt;

&lt;p&gt;–mac &lt;integer&gt; ：过滤最小等位基因 count 数大于等位该参数的位点
--max-mac &lt;integer&gt;：过滤最小等位基因 count 数小于等于该参数的位点&lt;/integer&gt;&lt;/integer&gt;&lt;/p&gt;

&lt;p&gt;–min-alleles &lt;integer&gt; 
--max-alleles &lt;integer&gt;&lt;/integer&gt;&lt;/integer&gt;&lt;/p&gt;

&lt;p&gt;过滤等位基因数小于或者大于该参数的位点，可以结合使用，例如，&lt;code class=&quot;highlighter-rouge&quot;&gt;vcftools --vcf file1.vcf --min-alleles 2 --max-alleles 2&lt;/code&gt; 过滤只有两个等位基因的位点。&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;根据基因型数值过滤&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;–min-meanDP &lt;float&gt; 
--max-meanDP &lt;float&gt;&lt;/float&gt;&lt;/float&gt;&lt;/p&gt;

&lt;p&gt;根据测序深度过滤&lt;/p&gt;

&lt;p&gt;–hwe &lt;float&gt;：哈迪-温伯格平衡&lt;/float&gt;&lt;/p&gt;

&lt;p&gt;Assesses sites for Hardy-Weinberg Equilibrium using an exact test, as defined by Wigginton, Cutler and Abecasis (2005). Sites with a p-value below the threshold defined by this option are taken to be out of HWE, and therefore excluded.&lt;/p&gt;

&lt;p&gt;–max-missing &lt;float&gt;：根据缺失数据比例过滤&lt;/float&gt;&lt;/p&gt;

&lt;p&gt;Exclude sites on the basis of the proportion of missing data (defined to be between 0 and 1, where 0 allows sites that are completely missing and 1 indicates no missing data allowed).&lt;/p&gt;

&lt;p&gt;–max-missing-count &lt;integer&gt;&lt;/integer&gt;&lt;/p&gt;

&lt;p&gt;Exclude sites with more than this number of missing genotypes over all individuals.&lt;/p&gt;

&lt;p&gt;–phased&lt;/p&gt;

&lt;p&gt;Excludes all sites that contain unphased genotypes.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;杂项过滤
–minQ &lt;float&gt;：根据 Quality 值过滤&lt;/float&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;section-3&quot;&gt;2.3. 样本过滤参数&lt;/h4&gt;

&lt;p&gt;–indv &lt;string&gt; 
--remove-indv &lt;string&gt;&lt;/string&gt;&lt;/string&gt;&lt;/p&gt;

&lt;p&gt;使用或者不使用某样本，可以多次使用该参数。&lt;/p&gt;

&lt;p&gt;–keep &lt;filename&gt; 
--remove &lt;filename&gt;&lt;/filename&gt;&lt;/filename&gt;&lt;/p&gt;

&lt;p&gt;使用或者移除的文件中所列的本亲。样本 ID （与 VCF 表头相同）每个一行。如果同时使用两参数，&lt;code class=&quot;highlighter-rouge&quot;&gt;--keep&lt;/code&gt; 先于 &lt;code class=&quot;highlighter-rouge&quot;&gt;--remove&lt;/code&gt; 运行。如果使用了多个文件，先保留所有 ’–keep‘ 文件中的样本，再删除其中 ’–remove‘ 所有文件中的样本。&lt;/p&gt;

&lt;p&gt;–max-indv &lt;integer&gt;: Randomly thins individuals so that only the specified number are retained.&lt;/integer&gt;&lt;/p&gt;

&lt;h4 id=&quot;section-4&quot;&gt;2.4. 基因型过滤参数&lt;/h4&gt;

&lt;p&gt;–remove-filtered-geno-all&lt;/p&gt;

&lt;p&gt;Excludes all genotypes with a FILTER flag not equal to “.” (a missing value) or PASS.&lt;/p&gt;

&lt;p&gt;–remove-filtered-geno &lt;string&gt;&lt;/string&gt;&lt;/p&gt;

&lt;p&gt;Excludes genotypes with a specific FILTER flag.&lt;/p&gt;

&lt;p&gt;–minGQ &lt;float&gt;&lt;/float&gt;&lt;/p&gt;

&lt;p&gt;Exclude all genotypes with a quality below the threshold specified. This option requires that the “GQ” FORMAT tag is specified for all sites.&lt;/p&gt;

&lt;p&gt;–minDP &lt;float&gt; 
--maxDP &lt;float&gt;&lt;/float&gt;&lt;/float&gt;&lt;/p&gt;

&lt;p&gt;Includes only genotypes greater than or equal to the “–minDP” value and less than or equal to the “–maxDP” value. This option requires that the “DP” FORMAT tag is specified for all sites.&lt;/p&gt;

&lt;h4 id=&quot;section-5&quot;&gt;2.5. 输出参数&lt;/h4&gt;
&lt;ul&gt;
  &lt;li&gt;输出等位基因统计
-freq 
–freq2&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;输出带有后缀 ’.frq‘ 文件中的每个位点的等位基因频率。第二选项禁止所有关于等位基因信息的输出。&lt;/p&gt;

&lt;p&gt;–counts 
–counts2&lt;/p&gt;

&lt;p&gt;输出带有后缀 ‘.frq.count’ 文件中的原始等位基因 counts 数。第二个选项禁止所有关于等位基因信息的输出。&lt;/p&gt;

&lt;p&gt;–derived&lt;/p&gt;

&lt;p&gt;For use with the previous four frequency and count options only. Re-orders the output file columns so that the ancestral allele appears first. This option relies on the ancestral allele being specified in the VCF file using the AA tag in the INFO field.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;输出深度统计&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;–depth&lt;/p&gt;

&lt;p&gt;Generates a file containing the mean depth per individual. This file has the suffix “.idepth”.&lt;/p&gt;

&lt;p&gt;–site-depth&lt;/p&gt;

&lt;p&gt;Generates a file containing the depth per site summed across all individuals. This output file has the suffix “.ldepth”.&lt;/p&gt;

&lt;p&gt;–site-mean-depth&lt;/p&gt;

&lt;p&gt;Generates a file containing the mean depth per site averaged across all individuals. This output file has the suffix “.ldepth.mean”.&lt;/p&gt;

&lt;p&gt;–geno-depth&lt;/p&gt;

&lt;p&gt;Generates a (possibly very large) file containing the depth for each genotype in the VCF file. Missing entries are given the value -1. The file has the suffix “.gdepth”.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;输出 LD 统计&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;–hap-r2&lt;/p&gt;

&lt;p&gt;Outputs a file reporting the r2, D, and D’ statistics using phased haplotypes. These are the traditional measures of LD often reported in the population genetics literature. The output file has the suffix “.hap.ld”. This option assumes that the VCF input file has phased haplotypes.&lt;/p&gt;

&lt;p&gt;–geno-r2&lt;/p&gt;

&lt;p&gt;Calculates the squared correlation coefficient between genotypes encoded as 0, 1 and 2 to represent the number of non-reference alleles in each individual. This is the same as the LD measure reported by PLINK. The D and D’ statistics are only available for phased genotypes. The output file has the suffix “.geno.ld”.&lt;/p&gt;

&lt;p&gt;–geno-chisq&lt;/p&gt;

&lt;p&gt;If your data contains sites with more than two alleles, then this option can be used to test for genotype independence via the chi-squared statistic. The output file has the suffix “.geno.chisq”.&lt;/p&gt;

&lt;p&gt;–hap-r2-positions &lt;positions list=&quot;&quot; file=&quot;&quot;&gt; 
--geno-r2-positions &lt;positions list=&quot;&quot; file=&quot;&quot;&gt;&lt;/positions&gt;&lt;/positions&gt;&lt;/p&gt;

&lt;p&gt;Outputs a file reporting the r2 statistics of the sites contained in the provided file verses all other sites. The output files have the suffix “.list.hap.ld” or “.list.geno.ld”, depending on which option is used.&lt;/p&gt;

&lt;p&gt;–ld-window &lt;integer&gt;&lt;/integer&gt;&lt;/p&gt;

&lt;p&gt;This optional parameter defines the maximum number of SNPs between the SNPs being tested for LD in the “–hap-r2”, “–geno-r2”, and “–geno-chisq” functions.&lt;/p&gt;

&lt;p&gt;–ld-window-bp &lt;integer&gt;&lt;/integer&gt;&lt;/p&gt;

&lt;p&gt;This optional parameter defines the maximum number of physical bases between the SNPs being tested for LD in the “–hap-r2”, “–geno-r2”, and “–geno-chisq” functions.&lt;/p&gt;

&lt;p&gt;–ld-window-min &lt;integer&gt;&lt;/integer&gt;&lt;/p&gt;

&lt;p&gt;This optional parameter defines the minimum number of SNPs between the SNPs being tested for LD in the “–hap-r2”, “–geno-r2”, and “–geno-chisq” functions.&lt;/p&gt;

&lt;p&gt;–ld-window-bp-min &lt;integer&gt;&lt;/integer&gt;&lt;/p&gt;

&lt;p&gt;This optional parameter defines the minimum number of physical bases between the SNPs being tested for LD in the “–hap-r2”, “–geno-r2”, and “–geno-chisq” functions.&lt;/p&gt;

&lt;p&gt;–min-r2 &lt;float&gt;&lt;/float&gt;&lt;/p&gt;

&lt;p&gt;This optional parameter sets a minimum value for r2, below which the LD statistic is not reported by the “–hap-r2”, “–geno-r2”, and “–geno-chisq” functions.&lt;/p&gt;

&lt;p&gt;–interchrom-hap-r2 
–interchrom-geno-r2&lt;/p&gt;

&lt;p&gt;Outputs a file reporting the r2 statistics for sites on different chromosomes. The output files have the suffix “.interchrom.hap.ld” or “.interchrom.geno.ld”, depending on the option used.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;OUTPUT TRANSITION/TRANSVERSION STATISTICS&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;–TsTv &lt;integer&gt;&lt;/integer&gt;&lt;/p&gt;

&lt;p&gt;Calculates the Transition / Transversion ratio in bins of size defined by this option. Only uses bi-allelic SNPs. The resulting output file has the suffix “.TsTv”.&lt;/p&gt;

&lt;p&gt;–TsTv-summary&lt;/p&gt;

&lt;p&gt;Calculates a simple summary of all Transitions and Transversions. The output file has the suffix “.TsTv.summary”.&lt;/p&gt;

&lt;p&gt;–TsTv-by-count&lt;/p&gt;

&lt;p&gt;Calculates the Transition / Transversion ratio as a function of alternative allele count. Only uses bi-allelic SNPs. The resulting output file has the suffix “.TsTv.count”.&lt;/p&gt;

&lt;p&gt;–TsTv-by-qual&lt;/p&gt;

&lt;p&gt;Calculates the Transition / Transversion ratio as a function of SNP quality threshold. Only uses bi-allelic SNPs. The resulting output file has the suffix “.TsTv.qual”.&lt;/p&gt;

&lt;p&gt;–FILTER-summary&lt;/p&gt;

&lt;p&gt;Generates a summary of the number of SNPs and Ts/Tv ratio for each FILTER category. The output file has the suffix “.FILTER.summary”.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;输出核酸多态性统计&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;–site-pi&lt;/p&gt;

&lt;p&gt;Measures nucleotide divergency on a per-site basis. The output file has the suffix “.sites.pi”.&lt;/p&gt;

&lt;p&gt;–window-pi &lt;integer&gt; 
--window-pi-step &lt;integer&gt;&lt;/integer&gt;&lt;/integer&gt;&lt;/p&gt;

&lt;p&gt;Measures the nucleotide diversity in windows, with the number provided as the window size. The output file has the suffix “.windowed.pi”. The latter is an optional argument used to specify the step size in between windows.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;输出 FST 统计&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;–weir-fst-pop &lt;filename&gt;&lt;/filename&gt;&lt;/p&gt;

&lt;p&gt;This option is used to calculate an Fst estimate from Weir and Cockerham’s 1984 paper. This is the preferred calculation of Fst. The provided file must contain a list of individuals (one individual per line) from the VCF file that correspond to one population. This option can be used multiple times to calculate Fst for more than two populations. These files will also be included as “–keep” options. By default, calculations are done on a per-site basis. The output file has the suffix “.weir.fst”.&lt;/p&gt;

&lt;p&gt;–fst-window-size &lt;integer&gt; 
--fst-window-step &lt;integer&gt;&lt;/integer&gt;&lt;/integer&gt;&lt;/p&gt;

&lt;p&gt;These options can be used with “–weir-fst-pop” to do the Fst calculations on a windowed basis instead of a per-site basis. These arguments specify the desired window size and the desired step size between windows.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;输出其它统计&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;–het&lt;/p&gt;

&lt;p&gt;Calculates a measure of heterozygosity on a per-individual basis. Specfically, the inbreeding coefficient, F, is estimated for each individual using a method of moments. The resulting file has the suffix “.het”.&lt;/p&gt;

&lt;p&gt;–hardy&lt;/p&gt;

&lt;p&gt;Reports a p-value for each site from a Hardy-Weinberg Equilibrium test (as defined by Wigginton, Cutler and Abecasis (2005)). The resulting file (with suffix “.hwe”) also contains the Observed numbers of Homozygotes and Heterozygotes and the corresponding Expected numbers under HWE.&lt;/p&gt;

&lt;p&gt;–TajimaD &lt;integer&gt;&lt;/integer&gt;&lt;/p&gt;

&lt;p&gt;Outputs Tajima’s D statistic in bins with size of the specified number. The output file has the suffix “.Tajima.D”.&lt;/p&gt;

&lt;p&gt;–indv-freq-burden&lt;/p&gt;

&lt;p&gt;This option calculates the number of variants within each individual of a specific frequency. The resulting file has the suffix “.ifreqburden”.&lt;/p&gt;

&lt;p&gt;–LROH&lt;/p&gt;

&lt;p&gt;This option will identify and output Long Runs of Homozygosity. The output file has the suffix “.LROH”. This function is experimental, and will use a lot of memory if applied to large datasets.&lt;/p&gt;

&lt;p&gt;–relatedness&lt;/p&gt;

&lt;p&gt;This option is used to calculate and output a relatedness statistic based on the method of Yang et al, Nature Genetics 2010 (doi:10.1038/ng.608). Specifically, calculate the unadjusted Ajk statistic. Expectation of Ajk is zero for individuals within a populations, and one for an individual with themselves. The output file has the suffix “.relatedness”.&lt;/p&gt;

&lt;p&gt;–relatedness2&lt;/p&gt;

&lt;p&gt;This option is used to calculate and output a relatedness statistic based on the method of Manichaikul et al., BIOINFORMATICS 2010 (doi:10.1093/bioinformatics/btq559). The output file has the suffix “.relatedness2”.&lt;/p&gt;

&lt;p&gt;–site-quality&lt;/p&gt;

&lt;p&gt;Generates a file containing the per-site SNP quality, as found in the QUAL column of the VCF file. This file has the suffix “.lqual”.&lt;/p&gt;

&lt;p&gt;–missing-indv&lt;/p&gt;

&lt;p&gt;Generates a file reporting the missingness on a per-individual basis. The file has the suffix “.imiss”.&lt;/p&gt;

&lt;p&gt;–missing-site&lt;/p&gt;

&lt;p&gt;Generates a file reporting the missingness on a per-site basis. The file has the suffix “.lmiss”.&lt;/p&gt;

&lt;p&gt;–SNPdensity &lt;integer&gt;&lt;/integer&gt;&lt;/p&gt;

&lt;p&gt;Calculates the number and density of SNPs in bins of size defined by this option. The resulting output file has the suffix “.snpden”.&lt;/p&gt;

&lt;p&gt;–kept-sites&lt;/p&gt;

&lt;p&gt;Creates a file listing all sites that have been kept after filtering. The file has the suffix “.kept.sites”.&lt;/p&gt;

&lt;p&gt;–removed-sites&lt;/p&gt;

&lt;p&gt;Creates a file listing all sites that have been removed after filtering. The file has the suffix “.removed.sites”.&lt;/p&gt;

&lt;p&gt;–singletons&lt;/p&gt;

&lt;p&gt;This option will generate a file detailing the location of singletons, and the individual they occur in. The file reports both true singletons, and private doubletons (i.e. SNPs where the minor allele only occurs in a single individual and that individual is homozygotic for that allele). The output file has the suffix “.singletons”.&lt;/p&gt;

&lt;p&gt;–hist-indel-len&lt;/p&gt;

&lt;p&gt;This option will generate a histogram file of the length of all indels (including SNPs). It shows both the count and the percentage of all indels for indel lengths that occur at least once in the input file. SNPs are considered indels with length zero. The output file has the suffix “.indel.hist”.&lt;/p&gt;

&lt;p&gt;–hapcount &lt;BED file=&quot;&quot;&gt;&lt;/BED&gt;&lt;/p&gt;

&lt;p&gt;This option will output the number of unique haplotypes within user specified bins, as defined by the BED file. The output file has the suffix “.hapcount”.&lt;/p&gt;

&lt;p&gt;–mendel &lt;PED file=&quot;&quot;&gt;&lt;/PED&gt;&lt;/p&gt;

&lt;p&gt;This option is use to report mendel errors identified in trios. The command requires a PLINK-style PED file, with the first four columns specifying a family ID, the child ID, the father ID, and the mother ID. The output of this command has the suffix “.mendel”.&lt;/p&gt;

&lt;p&gt;–extract-FORMAT-info &lt;string&gt;&lt;/string&gt;&lt;/p&gt;

&lt;p&gt;Extract information from the genotype fields in the VCF file relating to a specfied FORMAT identifier. The resulting output file has the suffix “.&lt;FORMAT_ID&gt;.FORMAT&quot;. For example, the following command would extract the all of the GT (i.e. Genotype) entries:&lt;/FORMAT_ID&gt;&lt;/p&gt;

&lt;p&gt;vcftools –vcf file1.vcf –extract-FORMAT-info GT&lt;/p&gt;

&lt;p&gt;–get-INFO &lt;string&gt;&lt;/string&gt;&lt;/p&gt;

&lt;p&gt;This option is used to extract information from the INFO field in the VCF file. The &lt;string&gt; argument specifies the INFO tag to be extracted, and the option can be used multiple times in order to extract multiple INFO entries. The resulting file, with suffix &quot;.INFO&quot;, contains the required INFO information in a tab-separated table. For example, to extract the NS and DB flags, one would use the command:&lt;/string&gt;&lt;/p&gt;

&lt;p&gt;vcftools –vcf file1.vcf –get-INFO NS –get-INFO DB&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;输出 VCF 格式&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;–recode 
–recode-bcf&lt;/p&gt;

&lt;p&gt;These options are used to generate a new file in either VCF or BCF from the input VCF or BCF file after applying the filtering options specified by the user. The output file has the suffix “.recode.vcf” or “.recode.bcf”. By default, the INFO fields are removed from the output file, as the INFO values may be invalidated by the recoding (e.g. the total depth may need to be recalculated if individuals are removed). This behavior may be overriden by the following options. By default, BCF files are written out as BGZF compressed files.&lt;/p&gt;

&lt;p&gt;–recode-INFO &lt;string&gt; 
--recode-INFO-all&lt;/string&gt;&lt;/p&gt;

&lt;p&gt;These options can be used with the above recode options to define an INFO key name to keep in the output file. This option can be used multiple times to keep more of the INFO fields. The second option is used to keep all INFO values in the original file.&lt;/p&gt;

&lt;p&gt;–contigs &lt;string&gt;&lt;/string&gt;&lt;/p&gt;

&lt;p&gt;This option can be used in conjuction with the –recode-bcf when the input file does not have any contig declarations. This option expects a file name with one contig header per line. These lines are included in the output file.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;输出其它格式&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;–012&lt;/p&gt;

&lt;p&gt;This option outputs the genotypes as a large matrix. Three files are produced. The first, with suffix “.012”, contains the genotypes of each individual on a separate line. Genotypes are represented as 0, 1 and 2, where the number represent that number of non-reference alleles. Missing genotypes are represented by -1. The second file, with suffix “.012.indv” details the individuals included in the main file. The third file, with suffix “.012.pos” details the site locations included in the main file.&lt;/p&gt;

&lt;p&gt;–IMPUTE&lt;/p&gt;

&lt;p&gt;This option outputs phased haplotypes in IMPUTE reference-panel format. As IMPUTE requires phased data, using this option also implies –phased. Unphased individuals and genotypes are therefore excluded. Only bi-allelic sites are included in the output. Using this option generates three files. The IMPUTE haplotype file has the suffix “.impute.hap”, and the IMPUTE legend file has the suffix “.impute.hap.legend”. The third file, with suffix “.impute.hap.indv”, details the individuals included in the haplotype file, although this file is not needed by IMPUTE.&lt;/p&gt;

&lt;p&gt;–ldhat 
–ldhat-geno&lt;/p&gt;

&lt;p&gt;These options output data in LDhat format. This option requires the “–chr” filter option to also be used. The first option outputs phased data only, and therefore also implies “–phased” be used, leading to unphased individuals and genotypes being excluded. The second option treats all of the data as unphased, and therefore outputs LDhat files in genotype/unphased format. Two output files are generated with the suffixes “.ldhat.sites” and “.ldhat.locs”, which correspond to the LDhat “sites” and “locs” input files respectively.&lt;/p&gt;

&lt;p&gt;–BEAGLE-GL 
–BEAGLE-PL&lt;/p&gt;

&lt;p&gt;These options output genotype likelihood information for input into the BEAGLE program. The VCF file is required to contain FORMAT fields with “GL” or “PL” tags, which can generally be output by SNP callers such as the GATK. Use of this option requires a chromosome to be specified via the “–chr” option. The resulting output file has the suffix “.BEAGLE.GL” or “.BEAGLE.PL” and contains genotype likelihoods for biallelic sites. This file is suitable for input into BEAGLE via the “like=” argument.&lt;/p&gt;

&lt;p&gt;–plink 
–plink-tped 
–chrom-map&lt;/p&gt;

&lt;p&gt;这些参数输出 PLINK PED 格式，产生两个文件，’.ped’ 和 ‘.map‘。仅双等位基因位点会被输出。具体请看 PLINK 说明文件。
注意：第一个选项对大数据集很慢。用户可以作用 ’–chr‘ 参数分割文件，或者使用 ‘–plink-tped’ 参数输出 PLINK 转置格式的文件，后缀为 ‘.tped’ 和 ‘.tfam’。
For usage with variant sites in species other than humans, the –chrom-map option may be used to specify a file name that has a tab-delimited mapping of chromosome name to a desired integer value with one line per chromosome. This file must contain a mapping for every chromosome value found in the file.&lt;/p&gt;

&lt;h4 id=&quot;section-6&quot;&gt;2.6. 比较参数&lt;/h4&gt;

&lt;p&gt;These options are used to compare the original variant file to another variant file and output the results. All of the diff functions require both files to contain the same chromosomes and that the files be sorted in the same order. If one of the files contains chromosomes that the other file does not, use the –not-chr filter to remove them from the analysis.&lt;/p&gt;

&lt;p&gt;DIFF VCF FILE&lt;/p&gt;

&lt;p&gt;–diff &lt;filename&gt; 
--gzdiff &lt;filename&gt; 
--diff-bcf &lt;filename&gt;&lt;/filename&gt;&lt;/filename&gt;&lt;/filename&gt;&lt;/p&gt;

&lt;p&gt;These options compare the original input file to this specified VCF, gzipped VCF, or BCF file. These options must be specified with one additional option described below in order to specify what type of comparison is to be performed. See the examples section for typical usage.&lt;/p&gt;

&lt;p&gt;DIFF OPTIONS&lt;/p&gt;

&lt;p&gt;–diff-site&lt;/p&gt;

&lt;p&gt;Outputs the sites that are common / unique to each file. The output file has the suffix “.diff.sites_in_files”.&lt;/p&gt;

&lt;p&gt;–diff-indv&lt;/p&gt;

&lt;p&gt;Outputs the individuals that are common / unique to each file. The output file has the suffix “.diff.indv_in_files”.&lt;/p&gt;

&lt;p&gt;–diff-site-discordance&lt;/p&gt;

&lt;p&gt;This option calculates discordance on a site by site basis. The resulting output file has the suffix “.diff.sites”.&lt;/p&gt;

&lt;p&gt;–diff-indv-discordance&lt;/p&gt;

&lt;p&gt;This option calculates discordance on a per-individual basis. The resulting output file has the suffix “.diff.indv”.&lt;/p&gt;

&lt;p&gt;–diff-indv-map &lt;filename&gt;&lt;/filename&gt;&lt;/p&gt;

&lt;p&gt;This option allows the user to specify a mapping of individual IDs in the second file to those in the first file. The program expects the file to contain a tab-delimited line containing an individual’s name in file one followed by that same individual’s name in file two with one mapping per line.&lt;/p&gt;

&lt;p&gt;–diff-discordance-matrix&lt;/p&gt;

&lt;p&gt;This option calculates a discordance matrix. This option only works with bi-allelic loci with matching alleles that are present in both files. The resulting output file has the suffix “.diff.discordance.matrix”.&lt;/p&gt;

&lt;p&gt;–diff-switch-error&lt;/p&gt;

&lt;p&gt;This option calculates phasing errors (specifically “switch errors”). This option creates an output file describing switch errors found between sites, with suffix “.diff.switch”.&lt;/p&gt;
</description>
        <pubDate>Mon, 24 Apr 2017 00:00:00 +0800</pubDate>
        <link>http://liuqibao.me/2017/04/24/vcftools-introduction/</link>
        <guid isPermaLink="true">http://liuqibao.me/2017/04/24/vcftools-introduction/</guid>
        
        <category>使用手册</category>
        
        
        <category>bioinformatics</category>
        
      </item>
    
      <item>
        <title>sratoolkit 工具的简单使用</title>
        <description>&lt;p&gt;sratoolkit 是 NCBI 的一个工具包，它包含很多数据格式转换的功能：
- Frequently Used Tools:
fastq-dump: Convert SRA data into fastq format&lt;/p&gt;

&lt;p&gt;prefetch: Allows command-line downloading of SRA, dbGaP, and ADSP data&lt;/p&gt;

&lt;p&gt;sam-dump: Convert SRA data to sam format&lt;/p&gt;

&lt;p&gt;sra-pileup: Generate pileup statistics on aligned SRA data&lt;/p&gt;

&lt;p&gt;vdb-config: Display and modify VDB configuration information&lt;/p&gt;

&lt;p&gt;vdb-decrypt: Decrypt non-SRA dbGaP data (“phenotype data”)&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Additional Tools:
abi-dump: Convert SRA data into ABI format (csfasta / qual)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;illumina-dump: Convert SRA data into Illumina native formats (qseq, etc.)&lt;/p&gt;

&lt;p&gt;sff-dump: Convert SRA data to sff format&lt;/p&gt;

&lt;p&gt;sra-stat: Generate statistics about SRA data (quality distribution, etc.)&lt;/p&gt;

&lt;p&gt;vdb-dump: Output the native VDB format of SRA data.&lt;/p&gt;

&lt;p&gt;vdb-encrypt: Encrypt non-SRA dbGaP data (“phenotype data”)&lt;/p&gt;

&lt;p&gt;vdb-validate: Validate the integrity of downloaded SRA data&lt;/p&gt;

&lt;p&gt;但是我常用的只有 fastq-dump 功能，就量将 sra 格式的压缩数据转换为 fastq 格式，我想大部分人也只用这个功能（都是被 NCBI 逼的！！）&lt;/p&gt;

&lt;h3 id=&quot;section&quot;&gt;1. 安装&lt;/h3&gt;
&lt;p&gt;sratools 的安装很简单，直接下载适合你版本的包，解压可用，不用编译，为了方便也可以放到环境变量下
我的系统是 Ubuntu，所以：
&lt;code class=&quot;highlighter-rouge&quot;&gt;
wget https://ftp-trace.ncbi.nlm.nih.gov/sra/sdk/2.8.2-1/sratoolkit.2.8.2-1-ubuntu64.tar.gz
tar zxvf sratoolkit.*
&lt;/code&gt;
所有的工具都在 sratoolkit 的 /bin 目录下&lt;/p&gt;

&lt;h3 id=&quot;fastq-dump-&quot;&gt;2. fastq-dump 的使用&lt;/h3&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;fastq-dump [options] &amp;lt;path/file&amp;gt; [&amp;lt;path/file&amp;gt; ...]
fastq-dump [options] &amp;lt;accession&amp;gt;
&lt;/div&gt;
&lt;p&gt;使用比较简单，需要注意的是对于单端测序和双端测序，软件给了不同的参数。&lt;/p&gt;

&lt;p&gt;–split-file：将文件分为两个部分，后缀为相应数字。
–split-3: 将文件分为三个部分，’&lt;em&gt;_1.fastaq’ 和 ’&lt;/em&gt;_2.fastq‘ 对双端测序数据是必有的，如果有未配对的数据，会放在 ’*。fastq‘ 文件中。&lt;/p&gt;

&lt;p&gt;所以，我的理解是，测序质量较好的话，对于双端测序，这两个参数产生的结果一样，‘–split-3’ 没有产生未配对文件。
在 biostar 上也有一些解释：
–split-3 will output 1,2, or 3 files: 1 file means the data is not paired. 2 files means paired data with no low quality reads or reads shorter than 20bp. 3 files means paired data, but asymmetric quality or trimming.  in the case of 3 file output, most people ignore &lt;file&gt;.fastq . this is a very old formatting option introduced for phase1 of 1000genomes.  before there were many analysis or trimming utilities and SRA submissions  always contained all reads from sequencer. back then nobody wanted to throw anything away. you might want to use --split-files instead. that will give only 2 files for paired-end data. or not bother with text output and access the data directly using sra ngs apis.&lt;/file&gt;&lt;/p&gt;
</description>
        <pubDate>Mon, 24 Apr 2017 00:00:00 +0800</pubDate>
        <link>http://liuqibao.me/2017/04/24/sratoolkit-instrodution/</link>
        <guid isPermaLink="true">http://liuqibao.me/2017/04/24/sratoolkit-instrodution/</guid>
        
        <category>使用手册</category>
        
        
        <category>bioinformatics</category>
        
      </item>
    
      <item>
        <title>从 NCBI 或者 EBI 下载数据</title>
        <description>&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#section&quot; id=&quot;markdown-toc-section&quot;&gt;1. 用迅雷下载（慢）&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#wget-&quot; id=&quot;markdown-toc-wget-&quot;&gt;2. 用 wget 下载（慢）&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#aspera-&quot; id=&quot;markdown-toc-aspera-&quot;&gt;3. 用 aspera 下载（推荐）&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#aspera--1&quot; id=&quot;markdown-toc-aspera--1&quot;&gt;aspera 批量下载&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;section&quot;&gt;1. 用迅雷下载（慢）&lt;/h3&gt;

&lt;p&gt;不会迅雷的请百度&lt;/p&gt;

&lt;h3 id=&quot;wget-&quot;&gt;2. 用 wget 下载（慢）&lt;/h3&gt;

&lt;ol&gt;
  &lt;li&gt;NCBI
在 NCBI 中双端测序和单端测序都是一个压缩的 ’.sra’ 文件
&lt;code class=&quot;highlighter-rouge&quot;&gt;
for i in $(cat list.txt);do wget ftp://ftp-trace.ncbi.nih.gov/sra/sra-instant/reads/ByRun/sra/SRR/`echo $i | cut -c 1-6`/$i/$i.sra;done
&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;EBI&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;EBI 的目录结构比较特别，注意匹配
EBI 的双端测序是两个 ‘.gzipp’ 文件
&lt;code class=&quot;highlighter-rouge&quot;&gt;
for i in $(cat list.txt);do wget ftp://fasp.sra.ebi.ac.uk:/vol1/fastq/`echo $i | cut -c 1-6`/00`echo $i|cut -c 10`/$i/* ;done
&lt;/code&gt;&lt;/p&gt;

&lt;h3 id=&quot;aspera-&quot;&gt;3. 用 aspera 下载（推荐）&lt;/h3&gt;

&lt;p&gt;aspera 的下载速度非常快，能达到几十上百兆/秒&lt;/p&gt;

&lt;p&gt;Aspera的用法：
ascp [参数] 目标文件 目的地址&lt;/p&gt;

&lt;p&gt;Aspera的常用参数：
-T
不进行加密。若不添加此参数，可能会下载不了。
-i string
输入私钥，安装 aspera 后有在目录 ~/.aspera/connect/etc/ 下有几个私钥，使用 linux 服务器的时候一般使用 asperaweb_id_dsa.openssh 文件作为私钥。
–host=string
ftp的host名，NCBI的为ftp-private.ncbi.nlm.nih.gov；EBI的为fasp.sra.ebi.ac.uk。
–user=string
用户名，NCBI的为anonftp，EBI的为era-fasp。
–mode=string
选择模式，上传为 send，下载为 recv。
-l string
设置最大传输速度，比如设置为 200M 则表示最大传输速度为 200m/s。若不设置该参数，则一般可达到10m/s的速度，而设置了，传输速度可以更高。
-L /dir
生成报告
-K2
错误后重新启动&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;NCBI&lt;/li&gt;
&lt;/ol&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;~/ascp -QT -l 300m -i ~/asperaweb_id_dsa.openssh anonftp@ftp-private.ncbi.nlm.nih.gov:/sra/sra-instant/reads/ByRun/sra/SRR/SRR169/SRR169$i/SRR169$i.sra ./
&lt;/div&gt;

&lt;ol&gt;
  &lt;li&gt;EBI
&lt;code class=&quot;highlighter-rouge&quot;&gt;
~/ascp -QT -l 300m -i /home/liuqibao/asperaweb_id_dsa.openssh era-fasp@fasp.sra.ebi.ac.uk:/vol1/fastq/SRR158/005/SRR1580695/SRR1580695_1.fastq.gz ./
&lt;/code&gt;
注意：可能需要加绝对路径，前面&lt;code class=&quot;highlighter-rouge&quot;&gt;~/&lt;/code&gt;不能少，否则会报错：key passpares&lt;/li&gt;
&lt;/ol&gt;

&lt;h1 id=&quot;aspera--1&quot;&gt;aspera 批量下载&lt;/h1&gt;
&lt;p&gt;批量下载：整理成下面的格式黏贴在文本SRR_Download_List_file_list.txt 中：&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;/sra/sra-instant/reads/ByRun/sra/SRR/SRR689/SRR689250/SRR689250.sra

/sra/sra-instant/reads/ByRun/sra/SRR/SRR893/SRR893046/SRR893046.sra

nohup ~/ascp  -i  ~/asperaweb_id_dsa.putty --mode recv --host ftp-private.ncbi.nlm.nih.gov --user anonftp   --file-list  SRR_Download_List_file_list.txt ./ &amp;amp;
&lt;/div&gt;
&lt;p&gt;### 4. prefech 下载&lt;/p&gt;

&lt;p&gt;NCBI 的 sratoolkit 中的 prefech 也可以下载 sra， 不过我没用过。&lt;/p&gt;
</description>
        <pubDate>Mon, 24 Apr 2017 00:00:00 +0800</pubDate>
        <link>http://liuqibao.me/2017/04/24/download-SRR/</link>
        <guid isPermaLink="true">http://liuqibao.me/2017/04/24/download-SRR/</guid>
        
        <category>数据上传下载</category>
        
        
      </item>
    
      <item>
        <title>gemma 简单使用</title>
        <description>&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#section&quot; id=&quot;markdown-toc-section&quot;&gt;2. 输入文件格式&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#plink-binary-ped-&quot; id=&quot;markdown-toc-plink-binary-ped-&quot;&gt;2.1 PLINK Binary PED 格式&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#bimbam-&quot; id=&quot;markdown-toc-bimbam-&quot;&gt;2.2 BIMBAM 文件格式&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-1&quot; id=&quot;markdown-toc-section-1&quot;&gt;2.3 相关性矩阵文件格式&lt;/a&gt;        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#section-2&quot; id=&quot;markdown-toc-section-2&quot;&gt;2.3.1 原始矩阵格式&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#section-3&quot; id=&quot;markdown-toc-section-3&quot;&gt;2.3.2 特征值和特征向量格式&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-4&quot; id=&quot;markdown-toc-section-4&quot;&gt;2.4 协变量文件格式（可选）&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#betaz-&quot; id=&quot;markdown-toc-betaz-&quot;&gt;2.5 Beta/Z 文件&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-5&quot; id=&quot;markdown-toc-section-5&quot;&gt;2.6 分类文件&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#ld-score-&quot; id=&quot;markdown-toc-ld-score-&quot;&gt;2.7 LD Score 文件&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#gemma&quot; id=&quot;markdown-toc-gemma&quot;&gt;3. 运行 GEMMA&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#gwas-&quot; id=&quot;markdown-toc-gwas-&quot;&gt;3.1 一个 GWAS 例子的小数据集&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#snp-&quot; id=&quot;markdown-toc-snp-&quot;&gt;3.2 SNP 过滤器&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-6&quot; id=&quot;markdown-toc-section-6&quot;&gt;3.3 用线性模型进行关联检验&lt;/a&gt;        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#section-7&quot; id=&quot;markdown-toc-section-7&quot;&gt;3.3.1 基本应用&lt;/a&gt;            &lt;ul&gt;
              &lt;li&gt;&lt;a href=&quot;#section-8&quot; id=&quot;markdown-toc-section-8&quot;&gt;3.3.2 详细信息&lt;/a&gt;&lt;/li&gt;
            &lt;/ul&gt;
          &lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#section-9&quot; id=&quot;markdown-toc-section-9&quot;&gt;3.3.3 输出文件&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-10&quot; id=&quot;markdown-toc-section-10&quot;&gt;3.4 估计来自基因型的相关性矩阵&lt;/a&gt;        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#section-11&quot; id=&quot;markdown-toc-section-11&quot;&gt;3.4.1 基本应用&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#section-12&quot; id=&quot;markdown-toc-section-12&quot;&gt;3.4.2 详细信息&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#section-13&quot; id=&quot;markdown-toc-section-13&quot;&gt;3.4.3 输出文件&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#eigen-decomposition&quot; id=&quot;markdown-toc-eigen-decomposition&quot;&gt;3.5 进行相关矩阵的 Eigen-Decomposition&lt;/a&gt;        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#section-14&quot; id=&quot;markdown-toc-section-14&quot;&gt;3.5.1 基本应用&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#section-15&quot; id=&quot;markdown-toc-section-15&quot;&gt;3.5.2 详细信息&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#section-16&quot; id=&quot;markdown-toc-section-16&quot;&gt;3.5.3 输出文件&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-17&quot; id=&quot;markdown-toc-section-17&quot;&gt;3.6 单变量线性混合模型的关联检验&lt;/a&gt;        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#section-18&quot; id=&quot;markdown-toc-section-18&quot;&gt;3.6.1 基本应用&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#section-19&quot; id=&quot;markdown-toc-section-19&quot;&gt;3.6.2 详细信息&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#section-20&quot; id=&quot;markdown-toc-section-20&quot;&gt;3.6.3 输出文件&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-21&quot; id=&quot;markdown-toc-section-21&quot;&gt;3.7 多变量线性混合模型的关联检验&lt;/a&gt;        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#section-22&quot; id=&quot;markdown-toc-section-22&quot;&gt;3.7.1 基本应用&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#section-23&quot; id=&quot;markdown-toc-section-23&quot;&gt;3.7.2 详细信息&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#section-24&quot; id=&quot;markdown-toc-section-24&quot;&gt;3.7.3 输出文件&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#fit-a-bayesian-sparse-linear-mixed-modelbslmm&quot; id=&quot;markdown-toc-fit-a-bayesian-sparse-linear-mixed-modelbslmm&quot;&gt;3.8 Fit a Bayesian Sparse Linear Mixed Model（BSLMM）&lt;/a&gt;        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#section-25&quot; id=&quot;markdown-toc-section-25&quot;&gt;3.8.1 基本应用&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#section-26&quot; id=&quot;markdown-toc-section-26&quot;&gt;3.8.2 详细信息&lt;/a&gt;            &lt;ul&gt;
              &lt;li&gt;&lt;a href=&quot;#section-27&quot; id=&quot;markdown-toc-section-27&quot;&gt;3.8.3 输出文件&lt;/a&gt;&lt;/li&gt;
            &lt;/ul&gt;
          &lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#bslmm-&quot; id=&quot;markdown-toc-bslmm-&quot;&gt;3.9 用来自 BSLMM 的输出文件预测表型&lt;/a&gt;        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#section-28&quot; id=&quot;markdown-toc-section-28&quot;&gt;3.9.1 基本应用&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#section-29&quot; id=&quot;markdown-toc-section-29&quot;&gt;3.9.2 详细信息&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#section-30&quot; id=&quot;markdown-toc-section-30&quot;&gt;3.9.3 输出文件&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-31&quot; id=&quot;markdown-toc-section-31&quot;&gt;3.10 相关性矩阵的方差分量估计&lt;/a&gt;        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#section-32&quot; id=&quot;markdown-toc-section-32&quot;&gt;3.10.1 基本应用&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#section-33&quot; id=&quot;markdown-toc-section-33&quot;&gt;3.10.2 详细信息&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#section-34&quot; id=&quot;markdown-toc-section-34&quot;&gt;3.10.3 输出文件&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#summary-statistics-&quot; id=&quot;markdown-toc-summary-statistics-&quot;&gt;3.11 Summary Statistics 的方差分量估计&lt;/a&gt;        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#section-35&quot; id=&quot;markdown-toc-section-35&quot;&gt;3.11.1 基本应用&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#section-36&quot; id=&quot;markdown-toc-section-36&quot;&gt;3.11.4 详细信息&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#section-37&quot; id=&quot;markdown-toc-section-37&quot;&gt;3.11.3 输出文件&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;GEMMA 要求基因型文件不能有缺失值，因此，SNP 要先 impute。
虽然有表型缺失的个体不会用于 LMM 或者 BSLMM 分析，但是所有个体仍全部用于计算相关矩阵，所以相关矩阵的结果仍是 n x n 的矩阵。
### 1. 安装&lt;/p&gt;

&lt;p&gt;gemma 安装很简单，直接下载二进制可执行文件就行，不用解压，不用编译。
最好再给它执行权限，&lt;code class=&quot;highlighter-rouge&quot;&gt;chmod a+x gemma&lt;/code&gt;。
这已经足够 45,000 的样本的分析，如果你的数据更大，可以使用编译安装。&lt;/p&gt;

&lt;h3 id=&quot;section&quot;&gt;2. 输入文件格式&lt;/h3&gt;

&lt;p&gt;GEMMA 需要四个主要的输入文件，包括基因型、表型、相关矩阵和协变量（可选）。
基因型和表型文件可以是两种格式，都是 PLINK binary ped 格式或者都 BIMBAM 格式。不可混用。&lt;/p&gt;

&lt;h3 id=&quot;plink-binary-ped-&quot;&gt;2.1 PLINK Binary PED 格式&lt;/h3&gt;

&lt;p&gt;GEMMA 识别基因型型和表型的 PLINK binary ped 文件格式.
该格式需要三个文件：*.bed, *.bim, *.bam，所有文件都有相同的前缀。
用户可以用 PLINK 将标准 ped 文件转换成 binary ped 文件：
命令：
&lt;code class=&quot;highlighter-rouge&quot;&gt;
plink --file [file_prefix] --make-bed --out [bedfile_prefix]
&lt;/code&gt;
对于 *.fam 文件，GEMMA 仅读取第二列（individual id）和第六列（phenotype）.
用户可以定义其它列作为 phenotype 列，使用 ‘-n [num]’ 参数，’-n 1’ 使用原始的第六列作为 phenotypes，’-n 2’ 使用第七列，以此类推。
GEMMA 用 0/1 编码等位基因。
*.bim 文件的第 5 列是 minor allele ，编码为 1；第 6 列为 major allele ，编码为 0.
因此，第 5 列的 minor allele 是效应基因。&lt;/p&gt;

&lt;p&gt;GEMMA 将按照提供的方式读入表型，’-9‘ 和 ‘NA’ 作为缺失表型。&lt;/p&gt;

&lt;h4 id=&quot;bimbam-&quot;&gt;2.2 BIMBAM 文件格式&lt;/h4&gt;

&lt;p&gt;详见&lt;a href=&quot;http://zzz.bwh.harvard.edu/plink/data.shtml&quot;&gt;使用手册&lt;/a&gt;&lt;/p&gt;

&lt;h4 id=&quot;section-1&quot;&gt;2.3 相关性矩阵文件格式&lt;/h4&gt;

&lt;p&gt;两种方法，使用原始相关矩阵，或者使用原始相关矩阵的特征值和特征微量。&lt;/p&gt;

&lt;h5 id=&quot;section-2&quot;&gt;2.3.1 原始矩阵格式&lt;/h5&gt;

&lt;p&gt;用户可以通过 ’-km [num]’ 参数选择使用哪种格式，即：
-km 1：PLINK binary ped 格式的第一种；或者 BIMPAM 格式；
-km 2: PLINK binary ped 格式的第二种（id id value）&lt;/p&gt;

&lt;h5 id=&quot;section-3&quot;&gt;2.3.2 特征值和特征向量格式&lt;/h5&gt;

&lt;p&gt;详见原文&lt;/p&gt;

&lt;h4 id=&quot;section-4&quot;&gt;2.4 协变量文件格式（可选）&lt;/h4&gt;

&lt;h4 id=&quot;betaz-&quot;&gt;2.5 Beta/Z 文件&lt;/h4&gt;

&lt;h4 id=&quot;section-5&quot;&gt;2.6 分类文件&lt;/h4&gt;

&lt;h4 id=&quot;ld-score-&quot;&gt;2.7 LD Score 文件&lt;/h4&gt;

&lt;h3 id=&quot;gemma&quot;&gt;3. 运行 GEMMA&lt;/h3&gt;

&lt;h4 id=&quot;gwas-&quot;&gt;3.1 一个 GWAS 例子的小数据集&lt;/h4&gt;

&lt;p&gt;该数据集在 GEMMA 的源文件中，可以在官网下载，也可以在 GitHub 下载。&lt;/p&gt;

&lt;h4 id=&quot;snp-&quot;&gt;3.2 SNP 过滤器&lt;/h4&gt;

&lt;p&gt;软件提供了几个 SNP 过滤器。&lt;/p&gt;

&lt;p&gt;多态性：没有多态性的 SNPs 不会用于分析。
缺失值：‘-miss [num]’ 参数调节，默认 5%。例，’-miss 0.1’
最小等位基因频率：‘-maf [num]’ 参数调节，默认 1%。例，’-maf 0.05’
Correlation with any covariate：’-r2 [num]‘ 调节，默认 0.9999。例，’-r2 0.999999
哈迪——温勃格平衡：‘-hww [num]’ 参数调节。例，‘-hwe 0.001’，将过滤 hwe 的 p 值小于 0.001 的 SNPs。&lt;/p&gt;

&lt;p&gt;以上阈值计算基于分析的个体（即，个体没有缺失的表型和没有缺失的协变量）。
因此，如果所有的个体都有缺失表型，那么没有 SNP 会被分析，输出矩阵为空。&lt;/p&gt;

&lt;h4 id=&quot;section-6&quot;&gt;3.3 用线性模型进行关联检验&lt;/h4&gt;

&lt;h5 id=&quot;section-7&quot;&gt;3.3.1 基本应用&lt;/h5&gt;

&lt;p&gt;用 PLINK bed 格式或者 BIMBAM 格式进行线性模型关联分析的基本应用：
&lt;code class=&quot;highlighter-rouge&quot;&gt;
./gemma -bfile [prefix] -lm [num] -o [prefix]
./gemma -g [filename] -p [filename] -a [filename] -lm [num] -o [prefix]
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;-lm：指定用哪种频数检验
  -lm 1：Wald test
  -lm 2: likelihood ratio test
  -lm 3：score test
  -lm 4: 以上三种检验
-bfile [prefix]: PLINK binary ped file 前缀
-g [filename]：BIMBAM mean genotype 文件名
-p [filename]：BIMBAM 表型文件名
-a [filename]：可选，BIMBAM SNP 注释文件名
-o [prefix] ：输出文件前缀&lt;/p&gt;

&lt;p&gt;注意：与线性混合模型不同，该分析不需要相关性矩阵&lt;/p&gt;

&lt;h6 id=&quot;section-8&quot;&gt;3.3.2 详细信息&lt;/h6&gt;

&lt;p&gt;对二进制性状，用户可以将对照组标记为 0 ，实验组标记为 1，然后通过把二进制化的对照实验标签当作数量性状，跟据以上方法用线性混合模型拟合数据。&lt;/p&gt;

&lt;h5 id=&quot;section-9&quot;&gt;3.3.3 输出文件&lt;/h5&gt;

&lt;p&gt;共有两个输出文件，都在当前目录下的文件夹中。
‘preix.log.txt’ 文件有一些关于运行参数和计算时间的细节信息。除此之外，还包含 PBE 检测和它的标准误。
’prefix.assoc.txt’ 文件包含结果。例如：
&lt;code class=&quot;highlighter-rouge&quot;&gt;
chr rs ps n_mis n_obs allele1 allele0 af beta se p_wald
1 rs3683945 3197400 0 1410 A G 0.443 -1.586575e-01 3.854542e-02 4.076703e-05
1 rs3707673 3407393 0 1410 G A 0.443 -1.563903e-01 3.855200e-02 5.252187e-05
1 rs6269442 3492195 0 1410 A G 0.365 -2.349908e-01 3.905200e-02 2.256622e-09
1 rs6336442 3580634 0 1410 A G 0.443 -1.566721e-01 3.857380e-02 5.141944e-05
1 rs13475700 4098402 0 1410 A C 0.127 2.209575e-01 5.644804e-02 9.497902e-05
&lt;/code&gt;
这 11 行是：染色体、SNP id、碱基对在染色体上的位置、相应 SNP 的缺失个体数量、相应 SNP 的无缺个体数量、最小等位基困、最大等位基因、等位基因频率、beta 检测、beta 标准误、Wald 检验的 P 值。&lt;/p&gt;

&lt;h4 id=&quot;section-10&quot;&gt;3.4 估计来自基因型的相关性矩阵&lt;/h4&gt;

&lt;h5 id=&quot;section-11&quot;&gt;3.4.1 基本应用&lt;/h5&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;./gemma -bfile [prefix] -gk [num] -o [prefix]
./gemma -g [filename] -p [filename] -gk [num] -o [prefix]
&lt;/div&gt;
&lt;p&gt;-gk [num]: 估计哪种相关性矩阵：
  -gk 1: centered relatedness matrix, 默认
  -gk 2: standardized relatedness matrix
-bfile [prefix]: PLINK binary ped file prefix
-g [filename]: 见 3.3
-p [filename]:  见 3.3
-o [prefix]: 见 3.3&lt;/p&gt;

&lt;p&gt;注意：BIMBAM mean genotype 文件可以用 gzip 压缩格式&lt;/p&gt;

&lt;h5 id=&quot;section-12&quot;&gt;3.4.2 详细信息&lt;/h5&gt;

&lt;p&gt;较低的最小等位基因频率趋于较大的效应：standardized genotype atrix
SNP 的效应大小不依赖于最小等位基因频率：ecntered genotype matrix&lt;/p&gt;

&lt;h5 id=&quot;section-13&quot;&gt;3.4.3 输出文件&lt;/h5&gt;

&lt;h4 id=&quot;eigen-decomposition&quot;&gt;3.5 进行相关矩阵的 Eigen-Decomposition&lt;/h4&gt;

&lt;h5 id=&quot;section-14&quot;&gt;3.5.1 基本应用&lt;/h5&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;./gemma -bfile [prefix] -k [filename] -eigen -o [prefix]
./gemma -g [filename] -p [filename] -k [filename] -eigen -o [prefix]
&lt;/div&gt;
&lt;p&gt;-b：见前文
-g：见前文
-p：见前文
-k [filename]：相关矩阵文件名&lt;/p&gt;

&lt;p&gt;注意：BIMBAM mean genotype/相关矩阵文件格式可以是 gzip 压缩格式&lt;/p&gt;

&lt;h5 id=&quot;section-15&quot;&gt;3.5.2 详细信息&lt;/h5&gt;

&lt;h5 id=&quot;section-16&quot;&gt;3.5.3 输出文件&lt;/h5&gt;

&lt;h4 id=&quot;section-17&quot;&gt;3.6 单变量线性混合模型的关联检验&lt;/h4&gt;

&lt;h5 id=&quot;section-18&quot;&gt;3.6.1 基本应用&lt;/h5&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;./gemma -bfile [prefix] -k [filename] -lmm [num] -o [prefix]
./gemma -g [filename] -p [filename] -a [filename] -k [filename] -lmm [num] -o [prefix]
&lt;/div&gt;
&lt;p&gt;-lmm：指定用哪种频数检验
  -lmm 1：Wald test
  -lmm 2: likelihood ratio test
  -lmm 3：score test
  -lmm 4: 以上三种检验
-bfile [prefix]: PLINK binary ped file 前缀
-g [filename]：BIMBAM mean genotype 文件名
-p [filename]：BIMBAM 表型文件名
-a [filename]：可选，BIMBAM SNP 注释文件名
-o [prefix] ：输出文件前缀
-k [filename]：相关矩阵文件名&lt;/p&gt;

&lt;p&gt;为检测基因-环境的交互作用，你可以加 ’-gxe [filename]’ 参数。
注意：‘-k [filename]’ 可以用 ‘-d [filename]’ （特征值文件）和 ‘-u [filename]’ （特征向量文件）所代替。&lt;/p&gt;

&lt;h5 id=&quot;section-19&quot;&gt;3.6.2 详细信息&lt;/h5&gt;

&lt;h5 id=&quot;section-20&quot;&gt;3.6.3 输出文件&lt;/h5&gt;

&lt;p&gt;见前文&lt;/p&gt;

&lt;h4 id=&quot;section-21&quot;&gt;3.7 多变量线性混合模型的关联检验&lt;/h4&gt;

&lt;h5 id=&quot;section-22&quot;&gt;3.7.1 基本应用&lt;/h5&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;./gemma -bfile [prefix] -k [filename] -lmm [num] -n [num1] [num2] [num3] -o [prefix]
./gemma -g [filename] -p [filename] -a [filename] -k [filename] -lmm [num] -n [num1] [num2] [num3] -o [prefix]
&lt;/div&gt;

&lt;p&gt;-lmm：指定用哪种频数检验
  -lmm 1：Wald test
  -lmm 2: likelihood ratio test
  -lmm 3：score test
  -lmm 4: 以上三种检验
-n [num1] [num2] [num3]: 表型文件中哪些表型用于关联
-bfile [prefix]: PLINK binary ped file 前缀
-g [filename]：BIMBAM mean genotype 文件名
-p [filename]：BIMBAM 表型文件名
-a [filename]：可选，BIMBAM SNP 注释文件名
-o [prefix] ：输出文件前缀
-k [filename]：相关矩阵文件名&lt;/p&gt;

&lt;p&gt;为检测基因-环境的交互作用，你可以加 ’-gxe [filename]’ 参数。
注意：‘-k [filename]’ 可以用 ‘-d [filename]’ （特征值文件）和 ‘-u [filename]’ （特征向量文件）所代替。&lt;/p&gt;

&lt;h5 id=&quot;section-23&quot;&gt;3.7.2 详细信息&lt;/h5&gt;

&lt;p&gt;建议表型的数量小于 10 个。
当表型的一小部分缺失的时候，用户可以在关联前推测缺失值:
&lt;code class=&quot;highlighter-rouge&quot;&gt;
./gemma -bfile [prefix] -k [filename] -predict -n [num1] [num2] [num3] -o [prefix]
./gemma -g [filename] -p [filename] -a [filename] -k [filename] -predict -n [num1] [num2] [num3] -o [prefix]
&lt;/code&gt;&lt;/p&gt;

&lt;h5 id=&quot;section-24&quot;&gt;3.7.3 输出文件&lt;/h5&gt;

&lt;p&gt;见前文&lt;/p&gt;

&lt;h4 id=&quot;fit-a-bayesian-sparse-linear-mixed-modelbslmm&quot;&gt;3.8 Fit a Bayesian Sparse Linear Mixed Model（BSLMM）&lt;/h4&gt;

&lt;h5 id=&quot;section-25&quot;&gt;3.8.1 基本应用&lt;/h5&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;./gemma -bfile [prefix] -bslmm [num] -o [prefix]
./gemma -g [filename] -p [filename] -a [filename] -bslmm [num] -o [prefix]

&lt;/div&gt;
&lt;p&gt;-bslmm [num]：
  -bslmm 1: a standard linear BSLMM，使用 MCMC
  -bslmm 2: a ridge regression/GBLUP，使用 standard non-MCMC 方法。最快
  -bslmm 3: a probit BSLMM，使用 MCMC。最慢&lt;/p&gt;

&lt;h5 id=&quot;section-26&quot;&gt;3.8.2 详细信息&lt;/h5&gt;

&lt;p&gt;注意：拟合 BSLMM 需要大量内存（例，4000 个体，400，000 SNPs，20 GB 内存），因为软件会存储整个基因型矩阵到内存中。
foat 版本（gemmaf）可以在不会缺失太大精度的情况下节省一半的内存。&lt;/p&gt;

&lt;p&gt;GEMMA 默认不需要用户提供相关性矩阵，它会自动计算，你也可以通过 ‘-k [filename]’ 自己提供。
在拟合 BSLMM 的时候，GEMMA 不需要协变量文件，然而，用户可以用 BIMBAM mean genotype 文件存储协变量，用 ‘-notsnp’ 参数使用它们。&lt;/p&gt;

&lt;p&gt;使用基于 MCMC 的方法时，用户可以通过 ‘-w [num]’ 选择 burn-in iterations 的数量，‘-s [num]’ 选择 sampling iterations 的数量。
此外，用户可以使用 ‘-smax [num]’ 选择用于模型的最大 SNPs 数量（即，有加性效应的 SNPs），probit BSLMM 很需要，因为它的计算负担重。
为了平衡计算精度和计算时间，用户可以自己决定使用这些参数。&lt;/p&gt;

&lt;h6 id=&quot;section-27&quot;&gt;3.8.3 输出文件&lt;/h6&gt;

&lt;p&gt;共有 5 个输出文件，位于当前目录的输出文件夹下。
prefix.log.txt：
prefix.hyp.txt：
prefix.param.txt：
prefix.bv.txt：一列育种值
prefix.gamma.txt：&lt;/p&gt;

&lt;h4 id=&quot;bslmm-&quot;&gt;3.9 用来自 BSLMM 的输出文件预测表型&lt;/h4&gt;

&lt;h5 id=&quot;section-28&quot;&gt;3.9.1 基本应用&lt;/h5&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;./gemma -bfile [prefix] -epm [filename] -emu [filename] -ebv [filename] -k [filename] -predict [num] -o [prefix]
./gemma -g [filename] -p [filename] -epm [filename] -emu [filename] -ebv [filename] -k [filename] -predict [num] -o [prefix]
&lt;/div&gt;
&lt;p&gt;-predict [num]: 预测值需要用正态累积分布函数（CDF）额外转换
  -predict 1: 获得预测值
  -predict 2: 获得预测值，用 CDF 将它们转换成概率大小。仅拟合 probit BSLMM 时用。
-epm [filename]：来自 BSLMM 的 prefix.param.txt
-emu [filename]: prefix.log.txt from BSLMM
-ebv [filename]: prefix.bv.txt from BSLMM
-k [filename]: 相关性矩阵&lt;/p&gt;

&lt;h5 id=&quot;section-29&quot;&gt;3.9.2 详细信息&lt;/h5&gt;

&lt;p&gt;使用拟合 BSLMM 中的同一个表型文件和基因型文件。
如果用户使用默认矩阵进行拟合 BSLMM，那么在第二步不需要提供 ‘-bev’ 和 ‘-k’。&lt;/p&gt;

&lt;h5 id=&quot;section-30&quot;&gt;3.9.3 输出文件&lt;/h5&gt;

&lt;p&gt;在当前目录的输出文件夹下有两个输出文件。
prefix.log.txt:
prefix.prdt.txt:有一列所有个体的预测值&lt;/p&gt;

&lt;h4 id=&quot;section-31&quot;&gt;3.10 相关性矩阵的方差分量估计&lt;/h4&gt;

&lt;h6 id=&quot;section-32&quot;&gt;3.10.1 基本应用&lt;/h6&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;./gemma -p [filename] -k [filename] -n [num] -vc [num] -o [prefix]
./gemma -p [filename] -mk [filename] -n [num] -vc [num] -o [prefix]
&lt;/div&gt;
&lt;p&gt;-vc: 作用哪种估计方式：
  -vc 1: 默认，使用 HE regression
  -vc 2: REML AI 算法
-n [num]: 使用表型的哪一列，默认 1&lt;/p&gt;

&lt;h5 id=&quot;section-33&quot;&gt;3.10.2 详细信息&lt;/h5&gt;

&lt;p&gt;默认 REML AI 算法的方差分量估计限制为正，用户可以在 ’-vc 2‘ 上用 ’-noconstrain‘。
HE regression 没有限制&lt;/p&gt;

&lt;h5 id=&quot;section-34&quot;&gt;3.10.3 输出文件&lt;/h5&gt;

&lt;h4 id=&quot;summary-statistics-&quot;&gt;3.11 Summary Statistics 的方差分量估计&lt;/h4&gt;

&lt;h5 id=&quot;section-35&quot;&gt;3.11.1 基本应用&lt;/h5&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;./gemma -beta [filename] -bfile [prefix] -vc 1 -o [prefix]
./gemma -beta [filename] -g [filename] -p [filename] -a [filename] -vc 1 -o [prefix]
&lt;/div&gt;
&lt;p&gt;-vc 1: MQS-HEW
-beta [filename]: beta 文件名&lt;/p&gt;

&lt;h5 id=&quot;section-36&quot;&gt;3.11.4 详细信息&lt;/h5&gt;

&lt;h5 id=&quot;section-37&quot;&gt;3.11.3 输出文件&lt;/h5&gt;

</description>
        <pubDate>Thu, 20 Apr 2017 00:00:00 +0800</pubDate>
        <link>http://liuqibao.me/2017/04/20/gemma-introdution/</link>
        <guid isPermaLink="true">http://liuqibao.me/2017/04/20/gemma-introdution/</guid>
        
        <category>使用手册</category>
        
        
        <category>bioinformatics</category>
        
      </item>
    
      <item>
        <title>gapit：用户使用手册</title>
        <description>&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#gapit-&quot; id=&quot;markdown-toc-gapit-&quot;&gt;GAPIT 的简单使用&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#section&quot; id=&quot;markdown-toc-section&quot;&gt;1. 安装&lt;/a&gt;        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#section-1&quot; id=&quot;markdown-toc-section-1&quot;&gt;2.1. 基本应用&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#enhanced-compression&quot; id=&quot;markdown-toc-enhanced-compression&quot;&gt;2.2. Enhanced Compression&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#section-2&quot; id=&quot;markdown-toc-section-2&quot;&gt;2.4. 基因组预测&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#section-3&quot; id=&quot;markdown-toc-section-3&quot;&gt;2.5. 多基因型文件&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#numeric-genotype-format&quot; id=&quot;markdown-toc-numeric-genotype-format&quot;&gt;2.6. Numeric Genotype Format&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#snps-fractional-snps-kinship--pcs&quot; id=&quot;markdown-toc-snps-fractional-snps-kinship--pcs&quot;&gt;2.8. 用部分 SNPs （Fractional SNPs）计算 Kinship 和 PCs&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#section-4&quot; id=&quot;markdown-toc-section-4&quot;&gt;2.9. 节省内存&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#section-5&quot; id=&quot;markdown-toc-section-5&quot;&gt;2.10. 模型选择&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#super&quot; id=&quot;markdown-toc-super&quot;&gt;2.11. SUPER&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-6&quot; id=&quot;markdown-toc-section-6&quot;&gt;3. 数据&lt;/a&gt;        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#section-7&quot; id=&quot;markdown-toc-section-7&quot;&gt;3.1 表型数据&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#section-8&quot; id=&quot;markdown-toc-section-8&quot;&gt;3.2 基因型数据&lt;/a&gt;            &lt;ul&gt;
              &lt;li&gt;&lt;a href=&quot;#hapmap-&quot; id=&quot;markdown-toc-hapmap-&quot;&gt;3.2.1 HapMap 格式&lt;/a&gt;&lt;/li&gt;
              &lt;li&gt;&lt;a href=&quot;#numeric-&quot; id=&quot;markdown-toc-numeric-&quot;&gt;3.2.2 numeric 格式&lt;/a&gt;&lt;/li&gt;
            &lt;/ul&gt;
          &lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#kinship&quot; id=&quot;markdown-toc-kinship&quot;&gt;3.3 Kinship&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#section-9&quot; id=&quot;markdown-toc-section-9&quot;&gt;3.4 协变量&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#section-10&quot; id=&quot;markdown-toc-section-10&quot;&gt;3.5 通过文件名输入基因型文件&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#gapit--1&quot; id=&quot;markdown-toc-gapit--1&quot;&gt;3.6 其它 GAPIT 参数&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-11&quot; id=&quot;markdown-toc-section-11&quot;&gt;4. 结果&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;gapit-&quot;&gt;GAPIT 的简单使用&lt;/h2&gt;

&lt;p&gt;GAPIT 2 是基于 R 语言的基因组关联和预测的整合工具包，提供了多种方法用于 GWAS 分析，包括 GLM、MLM、CMLM、P3D、EMMA等。
对于包含大量 SNPs 的大数据集，可以通过将基因型文件分隔成多个文件进行分析，例如，每个染色体一个文件。
GAPIT 的输入文件可以是 HapMap 格式，也可以是 EMMA 需要的 numerical 格式。&lt;/p&gt;

&lt;h3 id=&quot;section&quot;&gt;1. 安装&lt;/h3&gt;

&lt;p&gt;GAPIT 的需要几个 R 的依赖包，安装比较简单，具体请看&lt;a href=&quot;http://zzlab.net/GAPIT/&quot;&gt;使用手册&lt;/a&gt;，不再赘述。
&lt;code class=&quot;highlighter-rouge&quot;&gt;
source(&quot;http://www.bioconductor.org/biocLite.R&quot;)
biocLite(&quot;multtest&quot;)
install.packages(&quot;gplots&quot;)
install.packages(&quot;LDheatmap&quot;)
install.packages(&quot;genetics&quot;)
install.packages(&quot;ape&quot;)
install.packages(&quot;EMMREML&quot;)
install.packages(&quot;scatterplot3d&quot;)
&lt;/code&gt;
### 2. 使用&lt;/p&gt;

&lt;p&gt;以下包在每次使用前需要重新加载
```
library(multtest)
library(gplots)
library(LDheatmap)
library(genetics)
library(ape) # required for as.phylo
library(EMMREML)
library(compiler) #required for cmpfun
library(“scatterplot3d”)&lt;/p&gt;

&lt;p&gt;source(“http://www.zzlab.net/GAPIT/emma.txt”)           # 这两个脚本也可以下载到本地，通过本地路径加载
source(“http://www.zzlab.net/GAPIT/gapit_functions.txt”)
```&lt;/p&gt;

&lt;p&gt;可以下载官网提供的数据进行练习&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;setwd(&quot;/myGAPIT&quot;) # 设定工作目录，结果文件将输出到该目录
&lt;/div&gt;

&lt;h4 id=&quot;section-1&quot;&gt;2.1. 基本应用&lt;/h4&gt;

&lt;p&gt;基本应用需要两个文件（表型数据文件和基因型文件）和一个参数主成分的个数（&lt;code class=&quot;highlighter-rouge&quot;&gt;PCA.total&lt;/code&gt;）；GAPIT 会自动计算 K 矩阵（VanRaden 方法）；用默认的聚类算法（平均）和 group kinship type（Mean）进行 GWAS 分析。&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;# 输入文件
myY  &amp;lt;- read.table(&quot;mdp_traits.txt&quot;, head = TRUE)
myG &amp;lt;- read.delim(&quot;mdp_genotype_test.hmp.txt&quot;, head = FALSE)

# 运行 GAPIT
myGAPIT &amp;lt;- GAPIT(
Y=myY,
G=myG,
PCA.total=3,
)
&lt;/div&gt;

&lt;h4 id=&quot;enhanced-compression&quot;&gt;2.2. Enhanced Compression&lt;/h4&gt;

&lt;p&gt;在这个用法中，你可以指定其它的聚类算法（&lt;code class=&quot;highlighter-rouge&quot;&gt;kinship.cluster&lt;/code&gt; 参数控制），kinship summary statistic（‘kinship.group’ 参数）。
默认 ‘kinship.cluster=’average’、’kinship.group=’Mean’。
a specific range group numbers（即，k 矩阵的维度）可以通过’group.from’,’group.to’,’group.by’ 三个参数指定。
（好吧，我承认没看懂。。。）
&lt;code class=&quot;highlighter-rouge&quot;&gt;
#Step 1: Set data directory and import files
myY &amp;lt;- read.table(&quot;mdp_traits.txt&quot;, head = TRUE)
myG &amp;lt;- read.table(&quot;mdp_genotype_test.hmp.txt&quot;, head = FALSE)
#Step 2: Run GAPIT
myGAPIT &amp;lt;- GAPIT(
Y=myY,
G=myG,
PCA.total=3,
kinship.cluster=c(&quot;average&quot;, &quot;complete&quot;, &quot;ward&quot;),
kinship.group=c(&quot;Mean&quot;, &quot;Max&quot;),
group.from=200,
group.to=1000000,
group.by=10
)
&lt;/code&gt;
#### 2.3. 用户输入的 K 矩阵和协变量&lt;/p&gt;

&lt;p&gt;本用法假设用户提供了 K 矩阵和协变量文件。
你可以使用第三方软件产生的 K 矩阵或协变量（如，PCs 等）。
当用这种方法输入 PCs 时，参数 ‘PCA.total’ 应该设为 0 （默认），否则会出错。&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;#Step 1: Set data directory and import files
myY &amp;lt;- read.table(&quot;mdp_traits.txt&quot;, head = TRUE)
myG &amp;lt;- read.table(&quot;mdp_genotype_test.hmp.txt&quot;, head = FALSE)
myKI &amp;lt;- read.table(&quot;KSN.txt&quot;, head = FALSE)
myCV &amp;lt;- read.table(&quot;Copy of Q_First_Three_Principal_Components.txt&quot;, head = TRUE)
#Step 2: Run GAPIT
myGAPIT &amp;lt;- GAPIT(
Y=myY,
G=myG,
KI=myKI,
CV=myCV
)
&lt;/div&gt;

&lt;h4 id=&quot;section-2&quot;&gt;2.4. 基因组预测&lt;/h4&gt;

&lt;p&gt;Genomic prediction 不用进行 GWAS，所以需要关闭 GWAS 功能，参数为‘SNP.test=FALSE’。
&lt;code class=&quot;highlighter-rouge&quot;&gt;
#Step 1: Set data directory and import files
myY &amp;lt;- read.table(&quot;mdp_traits.txt&quot;, head = TRUE)
myKI &amp;lt;- read.table(&quot;KSN.txt&quot;, head = FALSE)
#Step 2: Run GAPIT
myGAPIT &amp;lt;- GAPIT(
Y=myY,
KI=myKI,
PCA.total=3,
SNP.test=FALSE
)
&lt;/code&gt;&lt;/p&gt;

&lt;h4 id=&quot;section-3&quot;&gt;2.5. 多基因型文件&lt;/h4&gt;

&lt;p&gt;在本用法中，来自用法 1 的 HapMap 基因型数据集被分割成多个基因型文件，每个文件对应一个染色体。
这个用法适用于在 R 中处理基因型文件太大的情况。
所有的基因型文件有一个通用名和一个扩展名，还有一个特定的序列号（例，’mdp_genotype_chr1.hmp.txt’,’mdp_genotype_chr2.hmp.txt’,…）。
用‘file.from’ 和 ’file.to‘ 参数声明开始和结束文件。
通常文件名（如，’mdp_genotype+chr’）和 扩展文件名（如，’hmp.txt’）通过 ’file.G’ 和 ‘file.Ext.G’ 参数传递给 GAPIT。
当没有提供 ‘file.path’ 参数时，GAPIT 尝试从当前目录查找文件。&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;#Step 1: Set data directory and import files
myY &amp;lt;- read.table(&quot;mdp_traits.txt&quot;, head = TRUE)
#Step 2: Run GAPIT
myGAPIT &amp;lt;- GAPIT(
Y=myY,
PCA.total=3,
file.G=&quot;mdp_genotype_chr&quot;,
file.Ext.G=&quot;hmp.txt&quot;,
file.from=1,
file.to=10,
file.path=&quot;C:\\myGAPIT\\&quot;
)
&lt;/div&gt;

&lt;h4 id=&quot;numeric-genotype-format&quot;&gt;2.6. Numeric Genotype Format&lt;/h4&gt;

&lt;p&gt;在本用法中，基因型数据集是用的不同的格式，numerical 格式。
需要两个基因型文件。
一个文件包含基因型数据（’GD’，参数），另一个文件包含染色体和每个 SNP 的碱基对位置（’GM’，参数）。
&lt;code class=&quot;highlighter-rouge&quot;&gt;
#Step 1: Set data directory and import files
myY &amp;lt;- read.table(&quot;mdp_traits.txt&quot;, head = TRUE)
myGD &amp;lt;- read.table(&quot;mdp_numeric.txt&quot;, head = TRUE)
myGM &amp;lt;- read.table(&quot;mdp_SNP_information.txt&quot; , head = TRUE)
#Step 2: Run GAPIT
myGAPIT &amp;lt;- GAPIT(
Y=myY,
GD=myGD,
GM=myGM,
PCA.total=3
)
&lt;/code&gt;
#### 2.7. 多个文件的 Numeric genotype Format&lt;/p&gt;

&lt;p&gt;在本用法中，用法 6 的 numeric genotype 数据集被分割成多个基因型文件。
基因型文件的通用名和扩展名通过 ‘file.GD’ 和 ‘file.Ext.GD’ 参数传递给 GAPIT。
基因型 map 文件的通用名和扩展名通过 ‘file.GM’ 和 ’file.Ext.GM’ 参数传递给 GAPIT。
&lt;code class=&quot;highlighter-rouge&quot;&gt;
#Step 1: Set data directory and import files
myY &amp;lt;- read.table(&quot;mdp_traits.txt&quot;, head = TRUE)
#Step 2: Run GAPIT
myGAPIT &amp;lt;- GAPIT(
Y=myY,
PCA.total=3,
file.GD=&quot;mdp_numeric&quot;,
file.GM=&quot;mdp_SNP_information&quot;,
file.Ext.GD=&quot;txt&quot;,
file.Ext.GM=&quot;txt&quot;,
file.from=1,
file.to=3,
)
&lt;/code&gt;&lt;/p&gt;

&lt;h4 id=&quot;snps-fractional-snps-kinship--pcs&quot;&gt;2.8. 用部分 SNPs （Fractional SNPs）计算 Kinship 和 PCs&lt;/h4&gt;

&lt;p&gt;选取总 SNPs 的部分进行计算可以节省计算时间，更重要的是它的结果类似。
fraction 可以通过 ‘Ratio’ 参数控制。
取样是随机的。
以下用的是 ’SNP.fraction=0.6’,总 SNPs 为 3093.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;#Step 1: Set data directory and import files
myY &amp;lt;- read.table(&quot;mdp_traits.txt&quot;, head = TRUE)
#Step 2: Run GAPIT
myGAPIT &amp;lt;- GAPIT(
Y=myY,
PCA.total=3,
file.GD=&quot;mdp_numeric&quot;,
file.GM=&quot;mdp_SNP_information&quot;,
file.Ext.GD=&quot;txt&quot;,
file.Ext.GM=&quot;txt&quot;,
file.from=1,
file.to=3,
SNP.fraction=0.6
)
&lt;/div&gt;

&lt;h4 id=&quot;section-4&quot;&gt;2.9. 节省内存&lt;/h4&gt;

&lt;p&gt;如果样本量很大，读入整个基因型数据集是很难的。
GPAIT 每次只载入一部分片段（fragment）。
默认 fragment 大小是 512 SNPs。
这个数字可以通过 ‘file.fragment’ 参数进行控制。
这个例子是用的 ‘file.fragment=128’&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;#Step 1: Set data directory and import files
myY &amp;lt;- read.table(&quot;mdp_traits.txt&quot;, head = TRUE)
#Step 2: Run GAPIT
myGAPIT &amp;lt;- GAPIT(
Y=myY,
PCA.total=3,
file.GD=&quot;mdp_numeric&quot;,
file.GM=&quot;mdp_SNP_information&quot;,
file.Ext.GD=&quot;txt&quot;,
file.Ext.GM=&quot;txt&quot;,
file.from=1,
file.to=3,
SNP.fraction=0.6,
file.fragment = 128
)
&lt;/div&gt;

&lt;h4 id=&quot;section-5&quot;&gt;2.10. 模型选择&lt;/h4&gt;

&lt;p&gt;群体结构相关性的程度随性状的改变而改变。
因此，在 GWAS 中，选择的完整的 PCs 并不是必须的。
GAPIT 可以通过通过基于贝叶斯信息评价的（BIC）的模型选择，寻找最合适的 PCs 数量。
参数为 ‘Model.selection=TRUE’
输出文件 ‘.BIC.Model.Selection.Results.csv’
```&lt;/p&gt;

&lt;p&gt;myY &amp;lt;- read.table(“mdp_traits.txt”, head = TRUE)
myG &amp;lt;- read.table(“mdp_genotype_test.hmp.txt”, head = FALSE)
#Step 2: Run GAPIT
myGAPIT &amp;lt;- GAPIT(
Y=myY,
G=myG,
PCA.total=3,
Model.selection = TRUE
)
```&lt;/p&gt;

&lt;h4 id=&quot;super&quot;&gt;2.11. SUPER&lt;/h4&gt;

&lt;p&gt;GAPIT 也提供了 SUPER GWAS 方法，它提取 SNPs 的小数据集用于 FaST-LMM。
&lt;code class=&quot;highlighter-rouge&quot;&gt;
#Step 1: Set data directory and import files
myCV &amp;lt;- read.table(&quot;Copy of Q_First_Three_Principal_Components.txt&quot;, head = TRUE)
myY &amp;lt;- read.table(&quot;mdp_traits.txt&quot;, head = TRUE)
myG &amp;lt;- read.table(&quot;mdp_genotype_test.hmp.txt&quot; , head = FALSE)
#Step 2: Run GAPIT
myGAPIT_SUPER &amp;lt;- GAPIT(
Y=myY[,c(1,2)],
G=myG,
#KI=myKI,
CV=myCV,
#PCA.total=3,
sangwich.top=&quot;MLM&quot;, #options are GLM,MLM,CMLM, FaST and SUPER
sangwich.bottom=&quot;SUPER&quot;, #options are GLM,MLM,CMLM, FaST and SUPER
LD=0.1,
)
&lt;/code&gt;&lt;/p&gt;

&lt;h3 id=&quot;section-6&quot;&gt;3. 数据&lt;/h3&gt;

&lt;p&gt;所有的输入数据都应该被保存在 ’\t‘ 分割的 text 文件中，建议 taxa 安字母表排序。&lt;/p&gt;

&lt;h4 id=&quot;section-7&quot;&gt;3.1 表型数据&lt;/h4&gt;

&lt;p&gt;多个性状可以放在一个文件中。
第一列为 ’taxa‘ （样本），其它列为表型数据。（’\t‘ 分割）
缺失数据用 ’NaN‘ 或者 ’NA‘。
&lt;code class=&quot;highlighter-rouge&quot;&gt;
myY &amp;lt;- read.table(&quot;mdp_traits.txt&quot;, head = TRUE)
head（myY）
  Taxa EarHT dpoll   EarDia
  1   811 59.50   NaN      NaN
  2  4226 65.50  59.5 32.21933
  3  4722 81.13  71.5 32.42100
  4 33-16 64.75  64.5      NaN
  5 38-11 92.25  68.5 37.89700
  6  A188 27.50  62.0 31.4190
&lt;/code&gt;&lt;/p&gt;

&lt;h4 id=&quot;section-8&quot;&gt;3.2 基因型数据&lt;/h4&gt;

&lt;p&gt;GWAS 需要基因型数据，基因组预测可不用。
基因型数据的数据格式可以用 HapMap 格式或者 numeric 格式。&lt;/p&gt;

&lt;h5 id=&quot;hapmap-&quot;&gt;3.2.1 HapMap 格式&lt;/h5&gt;

&lt;p&gt;HapMap 格式 SNP 信息（染色体及位置）和每个 taxa 的基因型保存在一个文件中。
具体格式自行 google
例子
&lt;code class=&quot;highlighter-rouge&quot;&gt;
myG &amp;lt;- read.table(&quot;mdp_genotype_test.hmp.txt&quot;, head = FALSE)
&lt;/code&gt;&lt;/p&gt;

&lt;h5 id=&quot;numeric-&quot;&gt;3.2.2 numeric 格式&lt;/h5&gt;

&lt;p&gt;numeric 格式有两个文件，一个包含基因型数据信息，一个包含 SNP 位置信息。
两个文件的排序应该相同。
例子
&lt;code class=&quot;highlighter-rouge&quot;&gt;
myGD &amp;lt;- read.table(&quot;mdp_numeric.txt&quot;, head = TRUE)
myGM &amp;lt;- read.table(&quot;mdp_SNP_information.txt&quot;, head = TRUE)
&lt;/code&gt;
格式转换:HapMap -&amp;gt; numeric
&lt;code class=&quot;highlighter-rouge&quot;&gt;
myG &amp;lt;- read.table(&quot;mdp_genotype_test.hmp.txt&quot;, head = FALSE) myGAPIT &amp;lt;- GAPIT(G=myG, output.numerical=TRUE)
myGD= myGAPIT$GD
myGM= myGAPIT$GM
&lt;/code&gt;&lt;/p&gt;

&lt;h4 id=&quot;kinship&quot;&gt;3.3 Kinship&lt;/h4&gt;

&lt;p&gt;K 矩阵在 GAPIT 中称之为 ’KI’。
第一列为样本名，其余为相关矩阵，没有表头。
例子：
&lt;code class=&quot;highlighter-rouge&quot;&gt;
myKI &amp;lt;- read.table(&quot;KSN.txt&quot;, head = FALSE)
&lt;/code&gt;&lt;/p&gt;

&lt;h4 id=&quot;section-9&quot;&gt;3.4 协变量&lt;/h4&gt;

&lt;p&gt;在 GAPIT 中，协变量文件叫 ‘CV’，包含群体结构信息（Q 矩阵）或者 PCs。
例子
&lt;code class=&quot;highlighter-rouge&quot;&gt;
myCV &amp;lt;- read.table(&quot;mdp_population_structure.txt&quot;, head = TRUE)
&lt;/code&gt;&lt;/p&gt;

&lt;h4 id=&quot;section-10&quot;&gt;3.5 通过文件名输入基因型文件&lt;/h4&gt;

&lt;p&gt;见第二部分，多基因型文件&lt;/p&gt;

&lt;h4 id=&quot;gapit--1&quot;&gt;3.6 其它 GAPIT 参数&lt;/h4&gt;

&lt;h3 id=&quot;section-11&quot;&gt;4. 结果&lt;/h3&gt;

&lt;p&gt;GAPIT 产生的结果保存为两种格式。
所有的表格结果保存为 .csv 文件，所有的图形保存为 .pdf 文件。&lt;/p&gt;

</description>
        <pubDate>Wed, 19 Apr 2017 00:00:00 +0800</pubDate>
        <link>http://liuqibao.me/2017/04/19/gapit-introdution/</link>
        <guid isPermaLink="true">http://liuqibao.me/2017/04/19/gapit-introdution/</guid>
        
        <category>使用手册</category>
        
        
        <category>bioinformatics</category>
        
      </item>
    
      <item>
        <title>edgeR：用户使用手册</title>
        <description>&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#section&quot; id=&quot;markdown-toc-section&quot;&gt;第 一 章&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#section-1&quot; id=&quot;markdown-toc-section-1&quot;&gt;简介&lt;/a&gt;        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#section-2&quot; id=&quot;markdown-toc-section-2&quot;&gt;1.1 使用范围&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#section-3&quot; id=&quot;markdown-toc-section-3&quot;&gt;1.2 引用&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#section-4&quot; id=&quot;markdown-toc-section-4&quot;&gt;1.3 如何获得帮助&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#quick-start&quot; id=&quot;markdown-toc-quick-start&quot;&gt;1.4 Quick start&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-5&quot; id=&quot;markdown-toc-section-5&quot;&gt;第 二 章&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#section-6&quot; id=&quot;markdown-toc-section-6&quot;&gt;功能概括&lt;/a&gt;        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#section-7&quot; id=&quot;markdown-toc-section-7&quot;&gt;2.1 术语&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#read-&quot; id=&quot;markdown-toc-read-&quot;&gt;2.2 将 read 比对到基因组上&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#read-counts-&quot; id=&quot;markdown-toc-read-counts-&quot;&gt;2.3 产生 read counts 的列表&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#counts&quot; id=&quot;markdown-toc-counts&quot;&gt;2.4 从一个文件中读入 counts&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#dgelist-&quot; id=&quot;markdown-toc-dgelist-&quot;&gt;2.5 DGEList 数据类&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#section-8&quot; id=&quot;markdown-toc-section-8&quot;&gt;2.6 过滤&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#section-9&quot; id=&quot;markdown-toc-section-9&quot;&gt;2.7 标准化&lt;/a&gt;            &lt;ul&gt;
              &lt;li&gt;&lt;a href=&quot;#section-10&quot; id=&quot;markdown-toc-section-10&quot;&gt;2.7.1 标准化仅对样本特异化影响是必须的&lt;/a&gt;&lt;/li&gt;
              &lt;li&gt;&lt;a href=&quot;#section-11&quot; id=&quot;markdown-toc-section-11&quot;&gt;2.7.2 测序深度&lt;/a&gt;&lt;/li&gt;
              &lt;li&gt;&lt;a href=&quot;#rna-&quot; id=&quot;markdown-toc-rna-&quot;&gt;2.7.3 RNA 组成&lt;/a&gt;&lt;/li&gt;
              &lt;li&gt;&lt;a href=&quot;#gc-&quot; id=&quot;markdown-toc-gc-&quot;&gt;2.7.4 GC 含量&lt;/a&gt;&lt;/li&gt;
              &lt;li&gt;&lt;a href=&quot;#section-12&quot; id=&quot;markdown-toc-section-12&quot;&gt;2.7.4 基因长度&lt;/a&gt;&lt;/li&gt;
              &lt;li&gt;&lt;a href=&quot;#section-13&quot; id=&quot;markdown-toc-section-13&quot;&gt;2.7.6 基于模型的标准化，而不是转化&lt;/a&gt;&lt;/li&gt;
              &lt;li&gt;&lt;a href=&quot;#pseudo-counts&quot; id=&quot;markdown-toc-pseudo-counts&quot;&gt;2.7.7 Pseudo-counts&lt;/a&gt;&lt;/li&gt;
            &lt;/ul&gt;
          &lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#section-14&quot; id=&quot;markdown-toc-section-14&quot;&gt;2.8 负二项模型&lt;/a&gt;            &lt;ul&gt;
              &lt;li&gt;&lt;a href=&quot;#section-15&quot; id=&quot;markdown-toc-section-15&quot;&gt;2.8.1 简介&lt;/a&gt;&lt;/li&gt;
              &lt;li&gt;&lt;a href=&quot;#bcv&quot; id=&quot;markdown-toc-bcv&quot;&gt;2.8.2 生物变异的影响（BCV）&lt;/a&gt;&lt;/li&gt;
              &lt;li&gt;&lt;a href=&quot;#bcvs&quot; id=&quot;markdown-toc-bcvs&quot;&gt;2.8.3 计算 BCVs&lt;/a&gt;&lt;/li&gt;
              &lt;li&gt;&lt;a href=&quot;#quasi-negative-binomial&quot; id=&quot;markdown-toc-quasi-negative-binomial&quot;&gt;2.8.4 Quasi negative binomial&lt;/a&gt;&lt;/li&gt;
            &lt;/ul&gt;
          &lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#section-16&quot; id=&quot;markdown-toc-section-16&quot;&gt;2.9 两组或多组的成对比较（经典方法）&lt;/a&gt;            &lt;ul&gt;
              &lt;li&gt;&lt;a href=&quot;#section-17&quot; id=&quot;markdown-toc-section-17&quot;&gt;2.9.1 计算离散度&lt;/a&gt;&lt;/li&gt;
              &lt;li&gt;&lt;a href=&quot;#de-genes-&quot; id=&quot;markdown-toc-de-genes-&quot;&gt;2.9.2 DE genes 检测&lt;/a&gt;&lt;/li&gt;
            &lt;/ul&gt;
          &lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#glm-&quot; id=&quot;markdown-toc-glm-&quot;&gt;2.10 更复杂的实验（glm 功能）&lt;/a&gt;            &lt;ul&gt;
              &lt;li&gt;&lt;a href=&quot;#glms&quot; id=&quot;markdown-toc-glms&quot;&gt;2.10.1 一般线性模型（GLMs）&lt;/a&gt;&lt;/li&gt;
              &lt;li&gt;&lt;a href=&quot;#section-18&quot; id=&quot;markdown-toc-section-18&quot;&gt;2.10.2 计算离散度&lt;/a&gt;&lt;/li&gt;
              &lt;li&gt;&lt;a href=&quot;#de-genes--1&quot; id=&quot;markdown-toc-de-genes--1&quot;&gt;2.10.3 DE genes 检验&lt;/a&gt;&lt;/li&gt;
            &lt;/ul&gt;
          &lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#section-19&quot; id=&quot;markdown-toc-section-19&quot;&gt;2.11 如果没有重复怎么办&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#fold-change-&quot; id=&quot;markdown-toc-fold-change-&quot;&gt;2.12 表达差异高于 fold-change 阈值&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#go--pathway-&quot; id=&quot;markdown-toc-go--pathway-&quot;&gt;2.13 GO 和 pathway 分析&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#gene-set-testing&quot; id=&quot;markdown-toc-gene-set-testing&quot;&gt;2.14 Gene set testing&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#clustering-heatmaps-&quot; id=&quot;markdown-toc-clustering-heatmaps-&quot;&gt;2.15 clustering, heatmaps 等&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#section-20&quot; id=&quot;markdown-toc-section-20&quot;&gt;2.16 可变剪接&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#crispr-cas9-tkg-shrna-seq-screen-&quot; id=&quot;markdown-toc-crispr-cas9-tkg-shrna-seq-screen-&quot;&gt;2.17 CRISPR-Cas9 tkg shRNA-seq screen 分析&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#section-21&quot; id=&quot;markdown-toc-section-21&quot;&gt;第 三 章 特异性实验设计&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#section-22&quot; id=&quot;markdown-toc-section-22&quot;&gt;3.1 简介&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#section-23&quot; id=&quot;markdown-toc-section-23&quot;&gt;3.2 两组或多组&lt;/a&gt;        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#section-24&quot; id=&quot;markdown-toc-section-24&quot;&gt;3.2.1 引言&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#section-25&quot; id=&quot;markdown-toc-section-25&quot;&gt;3.2.2 经典方法&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#glm--1&quot; id=&quot;markdown-toc-glm--1&quot;&gt;GLM 方法&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;section&quot;&gt;第 一 章&lt;/h2&gt;

&lt;h3 id=&quot;section-1&quot;&gt;简介&lt;/h3&gt;

&lt;h4 id=&quot;section-2&quot;&gt;1.1 使用范围&lt;/h4&gt;

&lt;p&gt;edgeR 主要用来分析 read 的表达差异，数据可以来自各个平台，如 RNA-seq、ChIP-seq、CRISR-Cas9 、SAGE-seq等。
edgeR 提供两各方法进行统计分析：
- 经典 edgeR：分析多组实验的精确统计方法
- glm edgeR：适合任何复杂的多因子实验的一般线性模型方法（glm）；这部分功能的名字以 ’glm‘ 标识
edgeR 的功能是基于经验贝叶斯方法的，它可以用于基因、外显子、转录本或者 tag 水平。&lt;/p&gt;

&lt;h4 id=&quot;section-3&quot;&gt;1.2 引用&lt;/h4&gt;

&lt;h4 id=&quot;section-4&quot;&gt;1.3 如何获得帮助&lt;/h4&gt;

&lt;h4 id=&quot;quick-start&quot;&gt;1.4 Quick start&lt;/h4&gt;

&lt;p&gt;edgeR 提供了很多分析方法。通常，建议使用 glm 流程，因为它非常灵活。
在 glm 框架在有两种检测方法：似然比检测和准似然比 F-test。&lt;/p&gt;

&lt;p&gt;这个例子用了 4 个RNA-seq 库，分为两组，counts 是排好序的，保存在文件中，基因符号位于一列，命名为 Symbol。&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;x &amp;lt;- read.delim(&quot;TableOfCounts.txt',row.names='Symbol') # 读入数据，也可以用 read.table 等，或者在 R 中手动构建数据框。
group &amp;lt;- factor(c(1,1,2,2)) # 分组
y &amp;lt;- DGEList(counts=x,group=group) # x 是包含 counts 的列，group 参数为分组；DGEList 是 edgeR 的数据结构
y &amp;lt;- calcNormFactors（y）#标准化
design &amp;lt;- model.matrix(~ group)
y &amp;lt;- estimatedisp（y，design）

&lt;/div&gt;

&lt;p&gt;准似然比 F-test：
&lt;code class=&quot;highlighter-rouge&quot;&gt;
fit &amp;lt;- glmQLFit(y,design)
qlf &amp;lt;- glmQLFTest(fit,coef=2)
topTags(qlf)
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;似然比检测：
&lt;code class=&quot;highlighter-rouge&quot;&gt;
fit &amp;lt;- glmFit(y,design)
lrt &amp;lt;- glmLRT(fit,coef=2)
topTags(lrt)
&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&quot;section-5&quot;&gt;第 二 章&lt;/h2&gt;

&lt;h3 id=&quot;section-6&quot;&gt;功能概括&lt;/h3&gt;

&lt;h4 id=&quot;section-7&quot;&gt;2.1 术语&lt;/h4&gt;

&lt;p&gt;为了简单起见，以下内容将基因组 feature 统称为 ’genes‘，其实它可以是转录本、外显子等等。&lt;/p&gt;

&lt;h4 id=&quot;read-&quot;&gt;2.2 将 read 比对到基因组上&lt;/h4&gt;

&lt;p&gt;featureCounts 和 htseq 都是可行的。&lt;/p&gt;

&lt;h4 id=&quot;read-counts-&quot;&gt;2.3 产生 read counts 的列表&lt;/h4&gt;

&lt;p&gt;edgeR 的输入文件要求是列表，每行是一个 genes ，每列是一个库（样本）。
注意：edgeR 应该使用实际的 read counts ，不建议使用预测的转录本丰度（例如 RPKM、FPKM）&lt;/p&gt;

&lt;h4 id=&quot;counts&quot;&gt;2.4 从一个文件中读入 counts&lt;/h4&gt;

&lt;p&gt;如果 counts 列表已经在一个文件中，那么需要读入它。
如果不同样本的数据存储在不同文件中，那么你需要单个读入并整合它们，readDGE 函数可以实现这个功能。这些文件需要两列，一列代表 gene 名字，一列代表 counts 数。&lt;/p&gt;

&lt;h4 id=&quot;dgelist-&quot;&gt;2.5 DGEList 数据类&lt;/h4&gt;

&lt;p&gt;edgeR 的数据存储在名为 DGEList 的对象中。
可以用 readDGE 直接构造，如果 counts 列表已经作为矩阵或者数据框输入，用 x 表示，那么：
&lt;code class=&quot;highlighter-rouge&quot;&gt;
y &amp;lt;- DGEList(counts=x)
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;可以同时加入分组因子：
&lt;code class=&quot;highlighter-rouge&quot;&gt;
group &amp;lt;- c(1,1,2,2)
y &amp;lt;- DGEList(coutns=x,group=group)
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;DGEList 对象的主要组成是一个 counts 矩阵，包括所有的 counts，一个 samples 信息的数据框，和一个可选的包含 genes 注释信息的数据框。&lt;/p&gt;

&lt;h4 id=&quot;section-8&quot;&gt;2.6 过滤&lt;/h4&gt;

&lt;p&gt;根据经验，如果 genes 在所有条件下的所有样本都没有表达，那么就应该过滤掉。
通常一个基因的 counts 为 5——10 才认为它表达了。
用户应该使用 count-per-million（CPM）指标过滤而不是直接过滤，因为直接过滤没有考虑库的大小。
命令：
&lt;code class=&quot;highlighter-rouge&quot;&gt;
keep &amp;lt;- rowSums(cpm(y)&amp;gt;1) &amp;gt;= 2
y &amp;lt;- y[keep,,keep.lib.sizes=FALSE]
&lt;/code&gt;
CPM 为 1 代表在最小的样本中，count 为 6——7。
因为每组至少有两个样本，所以要求至少在 2 个库中表达（&amp;gt;=2）。
这确保如果基因仅在 group 2 中的所有样本表达会保留下来。
建议过滤后重新计算库的大小，尽管它的影响非常小。
命令：
&lt;code class=&quot;highlighter-rouge&quot;&gt;
y$sample$lib.size &amp;lt;- colSums(y$counts)
&lt;/code&gt;&lt;/p&gt;

&lt;h4 id=&quot;section-9&quot;&gt;2.7 标准化&lt;/h4&gt;

&lt;h5 id=&quot;section-10&quot;&gt;2.7.1 标准化仅对样本特异化影响是必须的&lt;/h5&gt;

&lt;p&gt;edgeR 比较的两个环境下样本的表达水平的相关改变，而不是直接比较表达水平的绝对值。这简化了技术的影响。
例如，edgeR 不会考虑 genes 长度的影响，因为它与每个样本的 read counts 的影响相关。（即，通过比较表达水平的改变，已经修正过了）&lt;/p&gt;

&lt;h5 id=&quot;section-11&quot;&gt;2.7.2 测序深度&lt;/h5&gt;

&lt;p&gt;edgeR 通过不同库的大小修正测序深度对差异表达分析的影响，这部分已经考虑进 fold-change 或者 P-value 中。&lt;/p&gt;

&lt;h5 id=&quot;rna-&quot;&gt;2.7.3 RNA 组成&lt;/h5&gt;

&lt;p&gt;RNA 组成是第二重要的技术因素。
当少量的基因在一个样本中高差异表达，而在另一个样本中没有时，这个因素的影响会很大。
通过寻找库大小的比例因子，它可以最小化样本基因的 log-fold changes，calcNormFactors 函数标准化 RNA组成。
默认使用 TMM 方法估计比例因子。&lt;/p&gt;

&lt;p&gt;当两两样本间差异表达的基因被确定不会超过一半时，TMM 方法是大多数 RNA-seq 推荐的方法。
TMM 标准化的命令：
&lt;code class=&quot;highlighter-rouge&quot;&gt;
y &amp;lt;- calcNormFactors(y)
&lt;/code&gt;&lt;/p&gt;

&lt;h5 id=&quot;gc-&quot;&gt;2.7.4 GC 含量&lt;/h5&gt;

&lt;h5 id=&quot;section-12&quot;&gt;2.7.4 基因长度&lt;/h5&gt;

&lt;h5 id=&quot;section-13&quot;&gt;2.7.6 基于模型的标准化，而不是转化&lt;/h5&gt;

&lt;p&gt;注意：edgeR 需要的的原始的 read counts，不是转化后的，如 RPKM 或者 FPKM 值。&lt;/p&gt;

&lt;h5 id=&quot;pseudo-counts&quot;&gt;2.7.7 Pseudo-counts&lt;/h5&gt;

&lt;p&gt;经典的 edgeR 函数 estimateCommonDisp 和 exactTest 产生一个 pseudo-counts 矩阵作为输出的一部分。&lt;/p&gt;

&lt;h4 id=&quot;section-14&quot;&gt;2.8 负二项模型&lt;/h4&gt;

&lt;h5 id=&quot;section-15&quot;&gt;2.8.1 简介&lt;/h5&gt;

&lt;h5 id=&quot;bcv&quot;&gt;2.8.2 生物变异的影响（BCV）&lt;/h5&gt;

&lt;h5 id=&quot;bcvs&quot;&gt;2.8.3 计算 BCVs&lt;/h5&gt;

&lt;h5 id=&quot;quasi-negative-binomial&quot;&gt;2.8.4 Quasi negative binomial&lt;/h5&gt;

&lt;h4 id=&quot;section-16&quot;&gt;2.9 两组或多组的成对比较（经典方法）&lt;/h4&gt;

&lt;h5 id=&quot;section-17&quot;&gt;2.9.1 计算离散度&lt;/h5&gt;

&lt;p&gt;离散度为生物变异系数（BCV）的平方。
edgeR 对单因素实验使用 qCML（the quantile-adjusted conditional maximum likelihood）方法。&lt;/p&gt;

&lt;p&gt;仅当是单因素实验设计的时候才能使用 qCML 方法，不适于多因素实验设计。&lt;/p&gt;

&lt;p&gt;一次性计算 common dispersion 和 tagwise dispersion：
&lt;code class=&quot;highlighter-rouge&quot;&gt;
y &amp;lt;- estimateDisp（y）
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;计算 common dispersion：
&lt;code class=&quot;highlighter-rouge&quot;&gt;
y &amp;lt;- estimateCommaonDisp（y）
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;计算 tagwise disperson：
&lt;code class=&quot;highlighter-rouge&quot;&gt;
y &amp;lt;- estimateTagwiseDisp(y)
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;注意：如果独立计算，需要先计算 common dispersion，再计算 tagwise disperson。&lt;/p&gt;

&lt;h5 id=&quot;de-genes-&quot;&gt;2.9.2 DE genes 检测&lt;/h5&gt;

&lt;p&gt;精确检测是基于 qCML 方法的，仅适用于单因素实验。
&lt;code class=&quot;highlighter-rouge&quot;&gt;
et &amp;lt;- exactTest(y)
topTags(et)
&lt;/code&gt;&lt;/p&gt;

&lt;h4 id=&quot;glm-&quot;&gt;2.10 更复杂的实验（glm 功能）&lt;/h4&gt;

&lt;h5 id=&quot;glms&quot;&gt;2.10.1 一般线性模型（GLMs）&lt;/h5&gt;

&lt;h5 id=&quot;section-18&quot;&gt;2.10.2 计算离散度&lt;/h5&gt;

&lt;p&gt;对于多因素实验，edgeR CR 方法计算离散度，它通过一个设计矩阵拟合 GLM 模型来考虑多因素影响。&lt;/p&gt;

&lt;p&gt;一次性计算 common dispersion、trended dispersion 和 tagwise dispersion 的命令：
&lt;code class=&quot;highlighter-rouge&quot;&gt;
y &amp;lt;- estimateDisp(y,design)
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;计算 common dispersion：
&lt;code class=&quot;highlighter-rouge&quot;&gt;
y &amp;lt;- estimateGLMCommonDisp(y, design)
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;计算 trendedDisp（y，design）
&lt;code class=&quot;highlighter-rouge&quot;&gt;
y &amp;lt;- estimateGLMTrendedDisp（y，design）
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;计算 tagwise dispersion：
&lt;code class=&quot;highlighter-rouge&quot;&gt;
y &amp;lt;- estimateGLMTagwiseDisp（y，design）
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;注意：需要先计算 common dispersion 或者 trended dispersion，再计算 tagwise dispersion。
在多因素实验中，强烈建议使用 tagwise dispersion 方法。&lt;/p&gt;

&lt;h5 id=&quot;de-genes--1&quot;&gt;2.10.3 DE genes 检验&lt;/h5&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;group &amp;lt;- factor（c（1，1，2，2，3，3））
design &amp;lt;- model.matrix(~group)
fit &amp;lt;- glmFit(y,design)
&lt;/div&gt;

&lt;p&gt;拟合函数有三个参数，第一个 group 1 扩基准水平。
第二个和第三个是 2 vs 1 和 3 vs 1 差异&lt;/p&gt;

&lt;p&gt;比较 2 vs 1:
&lt;code class=&quot;highlighter-rouge&quot;&gt;
lrt.2vs1 &amp;lt;- glmLRT(fit, coef=2)
topTags(lrt.2vs1)
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;比较 3 vs 1:
&lt;code class=&quot;highlighter-rouge&quot;&gt;
lrt.3vs1 &amp;lt;- glmLRT(fit, coef=3)
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;比较 3 vs 2:
&lt;code class=&quot;highlighter-rouge&quot;&gt;
lrt.3vs2 &amp;lt;- glmLRT(fit, contrast=c(0,-1,1)) # contrast 参数需要一个零假设的统计检验，coefficient3——coefficient2 等于 0
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;寻找三个组都有的差异：
&lt;code class=&quot;highlighter-rouge&quot;&gt;
lrt &amp;lt;- glmLRT(fit,coef=2:3)
topTags(lrt)
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;也可以用 QL F-test 检验。
代码略。&lt;/p&gt;

&lt;h4 id=&quot;section-19&quot;&gt;2.11 如果没有重复怎么办&lt;/h4&gt;

&lt;p&gt;不推荐没有重复的实验，但是实在没有重复时，可以考虑以下选项：
1. 用描述性统计分析，包括 MDS plot 和 fold changes 分析。
2. 根据你的实验和相似数据，选择合适的离散度，用于 exactTest 或者 glmFit。对于人类等（可能是自由交配的物种）控制较好的实验，可以选择 BCV = 0.4；遗传上相同的模式生物（可能是指自交的生物，如植物）可以选择 BCV = 0.4；技术重复为 0.01.&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;bcv &amp;lt;- 0.2
counts &amp;lt;- matrix(rnbinom(40,size=1/bcv^2),20,2)
y &amp;lt;- DGEList(counts=counts,group=1:2)
et &amp;lt;- exactTest(y,dispersion=bcv^2)
&lt;/div&gt;

&lt;p&gt;注意:P-value 和显著基因的数量对离散度的选择非常敏感，对于没有控制的数据、没有考虑批次影响等等，可以实际使用更大的离散度。
然而，选择一个假设的离散度总比忽略生物学变异好。&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;通过从线性模型移除一个或更多因子，来创造残差自由度。具体见原文。&lt;/li&gt;
  &lt;li&gt;如果存在大量的没有 DE 的转录本，可以用它们来检测离散度。
例如，找一个在所有处理环境中都没有表达差异的基因作为 housekeeping （管家基因），通过它计算离散度。
首先，创建一个数据的 copy ，将所有处理视为一个组：
&lt;code class=&quot;highlighter-rouge&quot;&gt;
y1 &amp;lt;- y
y1$samples$grouop &amp;lt;- 1
&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;然后计算来自 housekeeping 基因的离散度，所有的库视为一组：
&lt;code class=&quot;highlighter-rouge&quot;&gt;
y0 &amp;lt;- estimateCommonDisp(y1[housekeeping,1])
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;然后将它插入所有数据对象：
&lt;code class=&quot;highlighter-rouge&quot;&gt;
y$sommon.dispersion &amp;lt;- y0$common.dispersion
et &amp;lt;- exactTest(y)
&lt;/code&gt;
注意：需要大量的控制转录本，至少有几十个，理想是数百个&lt;/p&gt;

&lt;h4 id=&quot;fold-change-&quot;&gt;2.12 表达差异高于 fold-change 阈值&lt;/h4&gt;

&lt;h4 id=&quot;go--pathway-&quot;&gt;2.13 GO 和 pathway 分析&lt;/h4&gt;

&lt;h4 id=&quot;gene-set-testing&quot;&gt;2.14 Gene set testing&lt;/h4&gt;

&lt;h4 id=&quot;clustering-heatmaps-&quot;&gt;2.15 clustering, heatmaps 等&lt;/h4&gt;

&lt;h4 id=&quot;section-20&quot;&gt;2.16 可变剪接&lt;/h4&gt;

&lt;h4 id=&quot;crispr-cas9-tkg-shrna-seq-screen-&quot;&gt;2.17 CRISPR-Cas9 tkg shRNA-seq screen 分析&lt;/h4&gt;

&lt;h2 id=&quot;section-21&quot;&gt;第 三 章 特异性实验设计&lt;/h2&gt;

&lt;h4 id=&quot;section-22&quot;&gt;3.1 简介&lt;/h4&gt;

&lt;p&gt;本章主要概括设计矩阵，比较一些经典的实验设计&lt;/p&gt;

&lt;h4 id=&quot;section-23&quot;&gt;3.2 两组或多组&lt;/h4&gt;

&lt;h5 id=&quot;section-24&quot;&gt;3.2.1 引言&lt;/h5&gt;

&lt;h5 id=&quot;section-25&quot;&gt;3.2.2 经典方法&lt;/h5&gt;

&lt;p&gt;经典 edgeR 方法进行组间的成对比较。
&lt;code class=&quot;highlighter-rouge&quot;&gt;
group &amp;lt;- factor(c('A','A','B','B','C','C'))
et &amp;lt;- exactTest(y,pair=c('A','B')) # B vs A
topTags(et)
et &amp;lt;- exactTest(y,pair=c('A','C')) # C vs A
et &amp;lt;- exactTest(y, pair=c('C','B')) # B vs C
et &amp;lt;- exactTest(y, pair=c(3,2)) # 用数字表示，等同于 B vs C
&lt;/code&gt;
具体细节见原文&lt;/p&gt;

&lt;h4 id=&quot;glm--1&quot;&gt;GLM 方法&lt;/h4&gt;

&lt;p&gt;GLM 方法允许多个组的比较。
GLM 方法需要一个设计矩阵，可以用 model.matrix 函数构造，也可以手动构造。
&lt;code class=&quot;highlighter-rouge&quot;&gt;
design &amp;lt;- model.matrix(~0+group,data=y$samples)
colnames(design) &amp;lt;- levels(y$samples$group)
&lt;/code&gt;&lt;/p&gt;

</description>
        <pubDate>Mon, 10 Apr 2017 00:00:00 +0800</pubDate>
        <link>http://liuqibao.me/2017/04/10/edgeR-introdution/</link>
        <guid isPermaLink="true">http://liuqibao.me/2017/04/10/edgeR-introdution/</guid>
        
        <category>使用手册</category>
        
        
        <category>bioinformatics</category>
        
      </item>
    
      <item>
        <title>HTseq 简单使用</title>
        <description>
&lt;p&gt;HTseq 是进行基因 count 表达量分析的软件，可以根据来自多种比对软件的 SAM/BAM 比对结果文件和基因结构注释 GTF 文件计算基因水平的 Counts 表达量
HTseq 安装需要 python2.7 以上，还需要几个 python 包，也建议用 pip 安装。
注意：
1. 若安装自己目录，运行：&lt;code class=&quot;highlighter-rouge&quot;&gt;python setup.py install --user
2. 自动生成的 htseq 在 &lt;/code&gt;~/.local/bin` 中&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;htseq-count [options] input.sam/bam genome.gtf &amp;gt; counts_out.txt
&lt;/div&gt;
&lt;p&gt;options:
-f：输入文件的格式，SAM/BAM；默认 sam。
-r：输入文件的排序方式，name/pos；默认 name。（需要用 samtools 对输入文件排序）
-s：设置是否是链特异性的，yes/no；默认 yes。（反人类的选项，一般情况是 no）
-a：忽略比对质量低于此值的比对结果；默认 10
-t：对指定的 feature（gtf/gff 第三列）进行表达量计算，而且忽略其它 ffeature；默认 exon
-i：设置 feature ID，由 gtf/gff 文件第 9 列标签决定，一般 gtf 为 gene_id, gff 为 ID；默认 gene_id
-m：表达量计算模式，三种，一般真核生物用 union，详细请看说明书；默认 union
-o：输出 sam 文件&lt;/p&gt;

&lt;p&gt;注意事项：
1. 输入文件必须有 sam/bam 比对结果和 gtf/gff 参考基因
2. gtf/gff 文件不能包含可变剪接信息，否则 HTSeq 会认为每个可变剪接都是单独的基因，导致计算结果为 ambiguous，对基因的 count 计算错误。&lt;/p&gt;

</description>
        <pubDate>Sun, 09 Apr 2017 00:00:00 +0800</pubDate>
        <link>http://liuqibao.me/2017/04/09/HTseq-introdution/</link>
        <guid isPermaLink="true">http://liuqibao.me/2017/04/09/HTseq-introdution/</guid>
        
        <category>使用手册</category>
        
        
        <category>bioinformatics</category>
        
      </item>
    
      <item>
        <title>SAM 格式简介及 samtools 工具的常用命令</title>
        <description>&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#sam-&quot; id=&quot;markdown-toc-sam-&quot;&gt;SAM 格式定义&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#samtools-&quot; id=&quot;markdown-toc-samtools-&quot;&gt;samtools 工具的常用命令&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;最近在做 RNA-seq 的时候，发现很多差异分析软件需要对 sam 文件进行排序，所以决定再研究一个 sam 格式。&lt;/p&gt;

&lt;h4 id=&quot;sam-&quot;&gt;SAM 格式定义&lt;/h4&gt;

&lt;p&gt;SAM  是序列比对的格式标准，是 sanger 制定的，它以制表符 &lt;code class=&quot;highlighter-rouge&quot;&gt;\t&lt;/code&gt; 为分割符。
完整的 sam 文件分为两个主要部分，注释信息（header section）和比对结果部分（alignment），比对结果是必须的，而注释信息是可忽略的。
注释信息以 &lt;code class=&quot;highlighter-rouge&quot;&gt;@&lt;/code&gt; 开头，用不同的标签（tag）表示不同的信息，例如： 
- @HD：符合标准的版本、对比序列的排列顺序
- @SQ：参考序列说明
- @RG：比对上的 reads 说明
- @PG：使用说明
- @Co：任意的说明信息&lt;/p&gt;

&lt;p&gt;比对结果，每行表示一个 segment 的比对信息，共被 &lt;code class=&quot;highlighter-rouge&quot;&gt;\t&lt;/code&gt; 分为 11 个字段和一个可靠字段，其顺序是固定的
1. QNAME：比对片段或者基因的编号
2. FLAG：平台比对情况的数字表示
3. RNAM：参考序列的名字，即，染色体号，无法比对用 &lt;code class=&quot;highlighter-rouge&quot;&gt;*&lt;/code&gt; 表示
4. position：read 比对到参考序列上，第一个碱基的位置，无法比对，则为 0
5. 比对质量分数
6. 匹配上的碱基数
…&lt;/p&gt;

&lt;h4 id=&quot;samtools-&quot;&gt;samtools 工具的常用命令&lt;/h4&gt;

&lt;p&gt;samtools 的新旧版本用法有些不同，此处用的 V1.4。&lt;/p&gt;

&lt;p&gt;一、view&lt;/p&gt;

&lt;p&gt;view 命令主要用于将 sam 格式转换成 bam 格式，只有转换成 bam 后才能对文件进行操作，例如排序、提取。&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;samtools view [options] bam/sam
&lt;/div&gt;
&lt;p&gt;options：
-o：输出文件的名字
-b：输出 BAM 格式；默认输出 SAM 格式
-h：设定输出 sam 文件时带 header 信息；默认输出 sam 不带 header 信息
-H：仅输出头文件信息
-S：输入文件是 sam 文件；默认输入文件是 bam 文件，新版本自动检测，可忽略该参数
-u：耗费磁盘空间，节约时间；需要 -b 参数&lt;/p&gt;

&lt;p&gt;例如：
&lt;code class=&quot;highlighter-rouge&quot;&gt;
samtools view -bS abc.sam &amp;gt; abc.bam #将 sam 转换成 bam
samtools view -T genome.fasta -h input.sam &amp;gt; input.h.sam 根据 fasta 文件，将 header 加入到 sam 或 bam 文件
samtools view -H input.bam &amp;gt; header.sam # 仅输出 header 文件
&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;二、sort&lt;/p&gt;

&lt;p&gt;sort 命令是对 bam 文件进行排序&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;samtools sort [options] input.bam 
&lt;/div&gt;
&lt;p&gt;options:
-@：线程数
-m：每个线程的最大内存
-n：根据 read 的名字（QNAME）排序，而不是染色体坐标排序；默认通过最左边的坐标排序。
-o：排序后的输出文件名；默认 samtools 基于 -o 文件的扩展名深度选择一个格式（如 .bam)；如果格式无法推测，则需要指定 -O
-O：指定输出格式 sam/bam/cram；&lt;/p&gt;

&lt;p&gt;例如：
&lt;code class=&quot;highlighter-rouge&quot;&gt;
samtools sort -@ 8 -o output.sorted.bam input.sam #输入 sam 文件，输出排好序的 bam 文件。
&lt;/code&gt;
注意：旧版本无法排序的同时转换格式，所以需要先用 view 转换格式，再用 sort 排序&lt;/p&gt;

&lt;p&gt;samtools 的命令还有很多，等用到的时候继续补充&lt;/p&gt;
</description>
        <pubDate>Sat, 08 Apr 2017 00:00:00 +0800</pubDate>
        <link>http://liuqibao.me/2017/04/08/sam-format-and-samtool-v1.4/</link>
        <guid isPermaLink="true">http://liuqibao.me/2017/04/08/sam-format-and-samtool-v1.4/</guid>
        
        <category>使用手册；数据格式</category>
        
        
        <category>bioinformatics</category>
        
      </item>
    
  </channel>
</rss>
