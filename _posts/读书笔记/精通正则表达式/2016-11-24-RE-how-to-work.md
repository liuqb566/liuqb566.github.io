---
layout: post
title: 第四章 正则表达式的匹配原理
categories: 文本编辑
tag: 正则表达式
---

* content
{:toc}


### 正则引擎的分类

+ DFA：确定型有穷自动机
	awk egrep flex lex MySQL Procmail

+ NFA：非确定型有穷自动机

	- 传统型NFA：GNU Emacs、Java grep less more .NET Per PHP Pthon Ruby sed vi

	- POSIX NFA: mawk GNU Emacs

### 匹配的基础

#### 规则1：优先选择最左端的匹配结果

***

引擎的构造

- 文字文本
- 字符组、点号、Unicode属性及其他
- 捕获型括号
- 锚点

***

#### 规则2: 标准量词是匹配优先

- 标准匹配量词：? * + {min,max} 都是匹配优先

### 表达式主导与文本主导

- #### NFA 引擎：表达式主导

- #### DFA 引擎：文本主导

### 回溯

**NFA 引擎最重要的性质:** 依次处理各个子表达式或组成元素，遇到需要在两个可能成功的可能中进行选择的时候，它发会选择其一，同时记住另一个，以备稍后可能的需要。

**需要做出选择的情形包括量词（决定是否尝试另一次匹配）和多选结构（决定选择哪个多选分支，留下哪个稍后尝试）。**

#### 回溯的两个要点

- 面对众多选择时，哪个分支应当首先选择？

	**如果需要在“进行尝试”和“跳过尝试”之间选择，对于匹配优先量词，引擎会优先选择“进行尝试”，而对于忽略优先量词，会选择“跳过尝试”。**

- 回溯时使用的是哪个之前保存的分支？
	**距离当前最近储存的选项就是当本地失败强制回溯时返回的。使用的原则是LIFO（last in first out，后进先出）。**

### 关于匹配优先和回溯的更多内容

#### 匹配优先的问题

匹配“McDonald's”？
	
	**关键：我们希望匹配的不是双引号之间的“任何文本”，而是“除双引号以外的任何文本”。

	用` "[^"]*" `取代` ".*" `


#### 使用忽略优先量词

- ？？
- *？
- ...
- 排除环视

####　匹配优先、忽略优先和回溯的要旨

- 无论是匹配优先还是忽略优先，只要引擎报告匹配失败，它就必然尝试了所有的可能。

- 匹配优先和忽略优先都不会影响需要检测路径的本身，而只会影响检测的顺序。

####　占有优先量词和固化分组

- 用（？〉...）实现固化分组

	固化分组的要旨：固化分组会放弃某些可能的路径。

#### 占有优先量词，?+ *+ ++ {m,n}+

#### 环视中的回溯

环视分为4种：肯定型、否定型、顺序环视与逆序环视

#### 多选结构

**多选结构既不是匹配优先的，也不是忽略优先的，而是按顺序排列的。**

### NFA、DFA和POSIX

#### 最左最长规则











